<section class="sa-purchase-cta py-5" style="background: linear-gradient(135deg, var(--c-brand-100) 0%, rgba(255,139,203,0.1) 100%);">
  <div class="container">
    <div class="text-center mb-5 animate-fade-up">
      <h2 class="mb-3" style="font-size: var(--fs-h1); color: var(--c-ink-900); font-weight: 500;" kjb-settings-id="{{ 'heading' | settings_id: section: section }}">
        {{ section.settings.heading | default: 'Ready to Transform Your Relationships?' }}
      </h2>
      <p style="font-size: var(--fs-body-lg); color: var(--c-ink-700); max-width: 600px; margin: 0 auto;" kjb-settings-id="{{ 'subheading' | settings_id: section: section }}">
        {{ section.settings.subheading | default: 'Join thousands who are building secure, lasting connections' }}
      </p>
    </div>
    
    <!-- Purchase options -->
    <div class="row g-4 justify-content-center mb-5">
      {% for block in section.blocks %}
        {% if block.type == 'purchase_option' %}
          <div class="col-lg-4 col-md-6">
            <div class="card-modern h-100 p-4 text-center animate-fade-up" style="animation-delay: {{ forloop.index | times: 0.1 }}s; {% if block.settings.featured %}border: 2px solid var(--c-brand-600); position: relative;{% endif %}">
              {% if block.settings.featured %}
                <div class="position-absolute" style="top: -12px; left: 50%; transform: translateX(-50%); background: var(--c-brand-600); color: white; padding: 4px 16px; border-radius: 100px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                  Most Popular
                </div>
              {% endif %}
              
              <div class="mb-3">
                <img src="{{ block.settings.retailer_logo | img_url: '200x' }}" 
                     alt="{{ block.settings.retailer_name }}" 
                     style="max-height: 40px; width: auto;"
                     loading="lazy">
              </div>
              
              <h3 class="mb-2" style="font-size: var(--fs-h3); color: var(--c-ink-900);" kjb-settings-id="{{ 'format' | settings_id: section: section, block: block }}">
                {{ block.settings.format }}
              </h3>
              
              <div class="mb-3">
                <span style="font-size: var(--fs-h2); color: var(--c-brand-600); font-weight: 600;" kjb-settings-id="{{ 'price' | settings_id: section: section, block: block }}">
                  {{ block.settings.price }}
                </span>
                {% if block.settings.original_price != blank %}
                  <span style="text-decoration: line-through; color: var(--c-ink-500); font-size: 16px; margin-left: 8px;" kjb-settings-id="{{ 'original_price' | settings_id: section: section, block: block }}">
                    {{ block.settings.original_price }}
                  </span>
                {% endif %}
              </div>
              
              {% if block.settings.features != blank %}
                <ul class="list-unstyled mb-4" style="font-size: 14px; color: var(--c-ink-600);">
                  {% assign features = block.settings.features | split: ',' %}
                  {% for feature in features %}
                    <li class="mb-1">âœ“ {{ feature | strip }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
              
              <a href="{{ block.settings.purchase_url }}" 
                 class="btn {% if block.settings.featured %}btn-primary-modern{% else %}btn-secondary-modern{% endif %} w-100"
                 target="_blank"
                 rel="noopener">
                {{ block.settings.button_text | default: 'Buy Now' }}
              </a>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
    
    <!-- FAQ or guarantee -->
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <div class="p-4" style="background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
          <h3 class="mb-3" style="font-size: var(--fs-h3); color: var(--c-ink-900);" kjb-settings-id="{{ 'guarantee_heading' | settings_id: section: section }}">
            {{ section.settings.guarantee_heading | default: 'Questions About the Book?' }}
          </h3>
          <p class="mb-0" style="color: var(--c-ink-600);" kjb-settings-id="{{ 'guarantee_text' | settings_id: section: section }}">
            {{ section.settings.guarantee_text | default: 'This workbook is for anyone wanting to work towards earned secure attachment by processing past experiences and learning new strategies. Perfect for individuals, couples, or therapy work.' }}
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "CTA - Purchase Book",
  "elements": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Ready to Transform Your Relationships?"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "guarantee_heading",
      "label": "Guarantee/FAQ Heading"
    },
    {
      "type": "textarea",
      "id": "guarantee_text",
      "label": "Guarantee/FAQ Text"
    }
  ],
  "blocks": [
    {
      "type": "purchase_option",
      "name": "CTA - Purchase Book",
      "elements": [
        {
          "type": "text",
          "id": "retailer_name",
          "label": "Retailer Name"
        },
        {
          "type": "image_picker",
          "id": "retailer_logo",
          "label": "Retailer Logo"
        },
        {
          "type": "text",
          "id": "format",
          "label": "Format",
          "default": "Paperback"
        },
        {
          "type": "text",
          "id": "price",
          "label": "Price"
        },
        {
          "type": "text",
          "id": "original_price",
          "label": "Original Price (Optional)"
        },
        {
          "type": "textarea",
          "id": "features",
          "label": "Features (comma separated)"
        },
        {
          "type": "text",
          "id": "purchase_url",
          "label": "Purchase URL"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "Buy Now"
        },
        {
          "type": "checkbox",
          "id": "featured",
          "label": "Featured Option",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "CTA - Purchase Book",
      "category": "Content",
      "blocks": [
        {
          "type": "purchase_option",
          "settings": {
            "retailer_name": "Amazon",
            "format": "Paperback",
            "price": "$18.99",
            "features": "Free shipping with Prime, Instant access to Kindle version, Easy returns",
            "purchase_url": "https://www.amazon.com/Securely-Attached-Transform-Attachment-Relationships/dp/1632174898",
            "button_text": "Buy on Amazon",
            "featured": true
          }
        },
        {
          "type": "purchase_option",
          "settings": {
            "retailer_name": "Penguin Random House",
            "format": "Paperback",
            "price": "$18.99",
            "features": "Official publisher, Author info, Book club resources",
            "purchase_url": "https://www.penguinrandomhouse.com/books/725779/securely-attached-by-harwood-eli/",
            "button_text": "Buy from Publisher",
            "featured": false
          }
        },
        {
          "type": "purchase_option",
          "settings": {
            "retailer_name": "Sasquatch Books",
            "format": "Paperback",
            "price": "$18.99",
            "features": "Support indie publisher, Direct from source, Author events",
            "purchase_url": "https://sasquatchbooks.com/books/securely-attached/",
            "button_text": "Buy from Sasquatch",
            "featured": false
          }
        }
      ]
    }
  ]
}
{% endschema %}