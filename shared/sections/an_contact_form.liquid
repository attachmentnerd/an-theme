{% comment %}
  AN Professional Contact Form Section
  - Multi-purpose contact form
  - Inquiry type selector
  - Professional fields
  - Two-column layout option
  - Form validation
{% endcomment %}

<section class="an-contact-form py-5" style="background: {{ section.settings.background_color }};">
  <div class="container">
    <div class="row">
      <!-- Form Column -->
      <div class="{% if section.settings.show_sidebar %}col-lg-8{% else %}col-lg-8 mx-auto{% endif %}">
        <!-- Section Header -->
        {% if section.settings.heading != blank or section.settings.subheading != blank %}
          <div class="mb-4 animate-fade-up">
            {% if section.settings.heading != blank %}
              <h2 style="font-size: var(--fs-h1); color: var(--c-ink-900); font-weight: 500; margin-bottom: 1rem;">
                {{ section.settings.heading }}
              </h2>
            {% endif %}
            {% if section.settings.subheading != blank %}
              <p style="font-size: var(--fs-body-lg); color: var(--c-ink-700);">
                {{ section.settings.subheading }}
              </p>
            {% endif %}
          </div>
        {% endif %}

        <!-- Contact Form -->
        <form class="an-contact-form__form animate-fade-up" 
              action="{{ section.settings.form_action }}" 
              method="post"
              data-form-type="contact"
              style="animation-delay: 0.1s;">
          
          {% if section.settings.show_inquiry_type %}
            <!-- Inquiry Type -->
            <div class="an-contact-form__field mb-4">
              <label for="inquiry-type-{{ section.id }}" class="an-contact-form__label">
                Type of Inquiry <span class="required">*</span>
              </label>
              <select id="inquiry-type-{{ section.id }}" 
                      name="inquiry_type" 
                      class="an-contact-form__select" 
                      required>
                <option value="">Select inquiry type...</option>
                <option value="parenting">Parenting Support</option>
                <option value="speaking">Speaking & Workshops</option>
                <option value="media">Media & Press</option>
                <option value="coaching">1:1 Coaching</option>
                <option value="courses">Course Questions</option>
                <option value="general">Just Want to Connect</option>
              </select>
            </div>
          {% endif %}

          <!-- Name Fields -->
          <div class="row">
            <div class="col-md-6">
              <div class="an-contact-form__field mb-4">
                <label for="first-name-{{ section.id }}" class="an-contact-form__label">
                  What should we call you? <span class="required">*</span>
                </label>
                <input type="text" 
                       id="first-name-{{ section.id }}" 
                       name="first_name" 
                       class="an-contact-form__input" 
                       required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="an-contact-form__field mb-4">
                <label for="last-name-{{ section.id }}" class="an-contact-form__label">
                  Family name <span class="required">*</span>
                </label>
                <input type="text" 
                       id="last-name-{{ section.id }}" 
                       name="last_name" 
                       class="an-contact-form__input" 
                       required>
              </div>
            </div>
          </div>

          <!-- Contact Fields -->
          <div class="row">
            <div class="col-md-6">
              <div class="an-contact-form__field mb-4">
                <label for="email-{{ section.id }}" class="an-contact-form__label">
                  Your email (we'll guard it carefully) <span class="required">*</span>
                </label>
                <input type="email" 
                       id="email-{{ section.id }}" 
                       name="email" 
                       class="an-contact-form__input" 
                       required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="an-contact-form__field mb-4">
                <label for="phone-{{ section.id }}" class="an-contact-form__label">
                  Phone (optional, but helpful for urgent matters)
                </label>
                <input type="tel" 
                       id="phone-{{ section.id }}" 
                       name="phone" 
                       class="an-contact-form__input">
              </div>
            </div>
          </div>

          {% if section.settings.show_organization %}
            <!-- Organization Fields -->
            <div class="row">
              <div class="col-md-6">
                <div class="an-contact-form__field mb-4">
                  <label for="organization-{{ section.id }}" class="an-contact-form__label">
                    Organization
                  </label>
                  <input type="text" 
                         id="organization-{{ section.id }}" 
                         name="organization" 
                         class="an-contact-form__input">
                </div>
              </div>
              <div class="col-md-6">
                <div class="an-contact-form__field mb-4">
                  <label for="role-{{ section.id }}" class="an-contact-form__label">
                    Your Role
                  </label>
                  <input type="text" 
                         id="role-{{ section.id }}" 
                         name="role" 
                         class="an-contact-form__input">
                </div>
              </div>
            </div>
          {% endif %}

          {% if section.settings.show_event_details %}
            <!-- Event Details (for speaking) -->
            <div class="an-contact-form__event-details" style="display: none;">
              <h3 class="an-contact-form__section-title">Event Details</h3>
              <div class="row">
                <div class="col-md-6">
                  <div class="an-contact-form__field mb-4">
                    <label for="event-date-{{ section.id }}" class="an-contact-form__label">
                      Event Date
                    </label>
                    <input type="date" 
                           id="event-date-{{ section.id }}" 
                           name="event_date" 
                           class="an-contact-form__input">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="an-contact-form__field mb-4">
                    <label for="event-location-{{ section.id }}" class="an-contact-form__label">
                      Event Location
                    </label>
                    <input type="text" 
                           id="event-location-{{ section.id }}" 
                           name="event_location" 
                           class="an-contact-form__input">
                  </div>
                </div>
              </div>
              <div class="an-contact-form__field mb-4">
                <label for="audience-size-{{ section.id }}" class="an-contact-form__label">
                  Expected Audience Size
                </label>
                <input type="text" 
                       id="audience-size-{{ section.id }}" 
                       name="audience_size" 
                       class="an-contact-form__input">
              </div>
            </div>
          {% endif %}

          <!-- Message -->
          <div class="an-contact-form__field mb-4">
            <label for="message-{{ section.id }}" class="an-contact-form__label">
              Share what's on your heart... <span class="required">*</span>
            </label>
            <textarea id="message-{{ section.id }}" 
                      name="message" 
                      class="an-contact-form__textarea" 
                      rows="6" 
                      required></textarea>
          </div>

          {% if section.settings.show_budget %}
            <!-- Budget Range -->
            <div class="an-contact-form__field mb-4">
              <label for="budget-{{ section.id }}" class="an-contact-form__label">
                Budget Range
              </label>
              <select id="budget-{{ section.id }}" 
                      name="budget" 
                      class="an-contact-form__select">
                <option value="">Prefer not to say</option>
                <option value="under-5k">Under $5,000</option>
                <option value="5k-10k">$5,000 - $10,000</option>
                <option value="10k-25k">$10,000 - $25,000</option>
                <option value="25k-plus">$25,000+</option>
              </select>
            </div>
          {% endif %}

          <!-- Newsletter Opt-in -->
          {% if section.settings.show_newsletter %}
            <div class="an-contact-form__field mb-4">
              <label class="an-contact-form__checkbox">
                <input type="checkbox" name="newsletter_signup" value="yes">
                <span>{{ section.settings.newsletter_text }}</span>
              </label>
            </div>
          {% endif %}

          <!-- Submit Button -->
          <div class="an-contact-form__submit">
            <button type="submit" class="btn btn-primary-modern btn-lg">
              {{ section.settings.submit_text }}
            </button>
          </div>

          <!-- Form Messages -->
          <div class="an-contact-form__messages mt-3">
            <div class="an-contact-form__success" style="display: none;">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="10" cy="10" r="9" fill="var(--c-accent-teal)"/>
                <path d="M14 7L8.5 12.5L6 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>{{ section.settings.success_message }}</span>
            </div>
            <div class="an-contact-form__error" style="display: none;">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="10" cy="10" r="9" fill="#FF6B6B"/>
                <path d="M10 6V10M10 14H10.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Oh no! Technology hiccup. Please try again, or email us directly at hello@attachmentnerd.com</span>
            </div>
          </div>
        </form>
      </div>

      <!-- Sidebar (optional) -->
      {% if section.settings.show_sidebar %}
        <div class="col-lg-4">
          <div class="an-contact-form__sidebar animate-fade-up" style="animation-delay: 0.2s;">
            {% for block in section.blocks %}
              {% case block.type %}
                {% when 'info_block' %}
                  <div class="an-contact-form__info-block" {{ block.shopify_attributes }}>
                    {% if block.settings.icon != blank %}
                      <div class="an-contact-form__info-icon">
                        <img src="{{ block.settings.icon | img_url: '48x48' }}" alt="" width="24" height="24">
                      </div>
                    {% endif %}
                    <h3 class="an-contact-form__info-title">{{ block.settings.title }}</h3>
                    <p class="an-contact-form__info-text">{{ block.settings.text }}</p>
                    {% if block.settings.link_text != blank %}
                      <a href="{{ block.settings.link_url }}" class="an-contact-form__info-link">
                        {{ block.settings.link_text }} â†’
                      </a>
                    {% endif %}
                  </div>
              {% endcase %}
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<style>
  .an-contact-form__form {
    background: white;
    padding: 2.5rem;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(26, 45, 78, 0.08);
  }

  .an-contact-form__section-title {
    font-size: var(--fs-body-lg);
    font-weight: 600;
    color: var(--c-ink-900);
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--c-ink-100);
  }

  .an-contact-form__label {
    display: block;
    font-size: var(--fs-body);
    font-weight: 500;
    color: var(--c-ink-800);
    margin-bottom: 0.5rem;
  }

  .an-contact-form__label .required {
    color: var(--c-accent-peach);
  }

  .an-contact-form__input,
  .an-contact-form__select,
  .an-contact-form__textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    font-size: var(--fs-body);
    color: var(--c-ink-900);
    background: white;
    border: 1px solid var(--c-ink-200);
    border-radius: 8px;
    transition: all 0.3s var(--ease-spring);
  }

  .an-contact-form__input:focus,
  .an-contact-form__select:focus,
  .an-contact-form__textarea:focus {
    outline: none;
    border-color: var(--c-brand-600);
    box-shadow: 0 0 0 4px rgba(94, 59, 255, 0.12);
    background: rgba(94, 59, 255, 0.02);
  }

  .an-contact-form__input.error,
  .an-contact-form__select.error,
  .an-contact-form__textarea.error {
    border-color: var(--c-accent-peach);
    background: rgba(255, 139, 203, 0.05);
  }

  .an-contact-form__textarea {
    resize: vertical;
    min-height: 120px;
  }

  .an-contact-form__checkbox {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    cursor: pointer;
    font-size: var(--fs-body);
    color: var(--c-ink-700);
  }

  .an-contact-form__checkbox input[type="checkbox"] {
    margin-top: 0.25rem;
    width: 18px;
    height: 18px;
    accent-color: var(--c-brand-600);
    cursor: pointer;
  }

  .an-contact-form__submit {
    margin-top: 2rem;
  }

  .an-contact-form__messages > div {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    border-radius: 8px;
    font-size: var(--fs-body);
  }

  .an-contact-form__success {
    background: rgba(24, 213, 228, 0.1);
    color: var(--c-ink-700);
  }

  .an-contact-form__error {
    background: rgba(255, 107, 107, 0.1);
    color: var(--c-ink-700);
  }

  /* Animation Classes */
  .animate-fade-up {
    opacity: 0;
    transform: translateY(40px);
    animation: fadeUp 0.8s var(--ease-spring) forwards;
  }

  @keyframes fadeUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Sidebar Styles */
  .an-contact-form__sidebar {
    padding-left: 2rem;
  }

  .an-contact-form__info-block {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(26, 45, 78, 0.06);
    margin-bottom: 1.5rem;
  }

  .an-contact-form__info-icon {
    width: 48px;
    height: 48px;
    background: var(--c-brand-100);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
  }

  .an-contact-form__info-title {
    font-size: var(--fs-body-lg);
    font-weight: 600;
    color: var(--c-ink-900);
    margin-bottom: 0.5rem;
  }

  .an-contact-form__info-text {
    font-size: var(--fs-body);
    color: var(--c-ink-700);
    margin-bottom: 1rem;
    line-height: 1.5;
  }

  .an-contact-form__info-link {
    font-size: var(--fs-body);
    color: var(--c-brand-600);
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s var(--ease-spring);
  }

  .an-contact-form__info-link:hover {
    color: var(--c-brand-800);
    transform: translateX(4px);
  }

  /* Hover Effects */
  .an-contact-form__info-block {
    transition: all 0.3s var(--ease-spring);
  }

  .an-contact-form__info-block:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(26, 45, 78, 0.12);
  }

  /* Custom Focus Styles */
  .an-contact-form__checkbox input[type="checkbox"]:focus {
    outline: 2px solid var(--c-brand-600);
    outline-offset: 2px;
  }

  /* Button Hover Effect */
  .btn-primary-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(94, 59, 255, 0.3);
  }

  /* Mobile Styles */
  @media (max-width: 991px) {
    .an-contact-form__sidebar {
      padding-left: 0;
      margin-top: 2rem;
    }
  }

  @media (max-width: 767px) {
    .an-contact-form__form {
      padding: 1.5rem;
    }

    .an-contact-form__info-block {
      padding: 1.5rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const section = document.querySelector('#shopify-section-{{ section.id }}');
    const form = section.querySelector('.an-contact-form__form');
    const inquirySelect = section.querySelector('select[name="inquiry_type"]');
    const eventDetails = section.querySelector('.an-contact-form__event-details');
    const successMsg = section.querySelector('.an-contact-form__success');
    const errorMsg = section.querySelector('.an-contact-form__error');

    // Show/hide event details based on inquiry type
    if (inquirySelect && eventDetails) {
      inquirySelect.addEventListener('change', function() {
        if (this.value === 'speaking') {
          eventDetails.style.display = 'block';
          // Smooth scroll to event details
          setTimeout(() => {
            eventDetails.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 100);
        } else {
          eventDetails.style.display = 'none';
        }
      });
    }

    // Enhanced form validation
    const validateField = (field) => {
      const value = field.value.trim();
      const fieldName = field.getAttribute('name');
      
      if (field.hasAttribute('required') && !value) {
        field.classList.add('error');
        return false;
      }
      
      // Email validation
      if (field.type === 'email' && value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
          field.classList.add('error');
          return false;
        }
      }
      
      field.classList.remove('error');
      return true;
    };

    // Real-time validation
    form.querySelectorAll('input, textarea, select').forEach(field => {
      field.addEventListener('blur', () => validateField(field));
    });

    // Form submission handling
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Hide any existing messages
      successMsg.style.display = 'none';
      errorMsg.style.display = 'none';
      
      // Validate all fields
      const fields = form.querySelectorAll('input[required], textarea[required], select[required]');
      let isValid = true;
      
      fields.forEach(field => {
        if (!validateField(field)) {
          isValid = false;
        }
      });
      
      if (!isValid) {
        errorMsg.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="9" fill="#FF6B6B"/><path d="M10 6V10M10 14H10.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span>Please fill in all required fields with care ðŸ’œ</span>';
        errorMsg.style.display = 'flex';
        return;
      }
      
      // Get form data
      const formData = new FormData(form);
      
      // Here you would normally send the form data to your server
      // For now, we'll just show a success message
      
      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Sending with love...';
      submitBtn.disabled = true;
      
      // Simulate API call
      setTimeout(function() {
        // Show success message
        successMsg.style.display = 'flex';
        
        // Reset form
        form.reset();
        
        // Hide event details if shown
        if (eventDetails) {
          eventDetails.style.display = 'none';
        }
        
        // Reset button
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        
        // Scroll to success message
        successMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 1500);
    });
  });
</script>

{% schema %}
{
  "name": "Forms - Contact",
  "elements": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Let's Connect â€“ Your Journey Matters"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Whether you're feeling stuck, curious, or ready to transform your family's emotional landscape â€“ we're here to walk alongside you."
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#FAFAFA"
    },
    {
      "type": "text",
      "id": "form_action",
      "label": "Form Action URL",
      "default": "/contact/submit",
      "info": "Where the form data should be sent"
    },
    {
      "type": "checkbox",
      "id": "show_sidebar",
      "label": "Show Sidebar",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_inquiry_type",
      "label": "Show Inquiry Type Selector",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_organization",
      "label": "Show Organization Fields",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_event_details",
      "label": "Show Event Details (for speaking)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_budget",
      "label": "Show Budget Range",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_newsletter",
      "label": "Show Newsletter Opt-in",
      "default": true
    },
    {
      "type": "text",
      "id": "newsletter_text",
      "label": "Newsletter Opt-in Text",
      "default": "Yes! I'd love weekly connection tips and attachment insights in my inbox ðŸ’Œ"
    },
    {
      "type": "text",
      "id": "submit_text",
      "label": "Submit Button Text",
      "default": "Send My Message ðŸ’œ"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success Message",
      "default": "Your message landed safely! We'll respond within 24-48 hours with the care your story deserves."
    }
  ],
  "blocks": [
    {
      "type": "info_block",
      "name": "Sidebar Info Block",
      "elements": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Speaking Inquiries"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Text",
          "default": "Eli is available for keynotes, workshops, and panel discussions on attachment science and secure parenting."
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link Text",
          "default": "View Speaking Topics"
        },
        {
          "type": "action",
          "id": "link_url",
          "label": "Link URL",
          "default": "/speaking"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Contact Form",
      "category": "Forms",
      "description": "Professional contact form with inquiry types",
      "blocks": [
        {
          "type": "info_block",
          "settings": {
            "title": "Ready to Transform Your Event?",
            "text": "Eli brings 17+ years of clinical wisdom to every speaking engagement, making attachment science accessible and actionable.",
            "link_text": "View Speaking Topics",
            "link_url": "/speaking"
          }
        },
        {
          "type": "info_block",
          "settings": {
            "title": "Media Love",
            "text": "Featured in Parents Magazine, The Therapist Parent Podcast, and more. We love sharing attachment wisdom with your audience!",
            "link_text": "Download Media Kit",
            "link_url": "/media-kit"
          }
        },
        {
          "type": "info_block",
          "settings": {
            "title": "When You'll Hear Back",
            "text": "We read every message with care and respond within 48 hours. Your story matters, and we'll honor it with a thoughtful reply."
          }
        }
      ]
    }
  ]
}
{% endschema %}