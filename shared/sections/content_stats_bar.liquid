{% comment %}
  AN Stats/Impact Bar Section
  - Animated counting numbers
  - Flexible 2-4 stat blocks
  - Icon support
  - Mobile-optimized grid
  - Background options
{% endcomment %}

<section class="an-stats-bar py-5 bg-texture {% if section.settings.background_type == 'gradient' %}bg-texture--float-1 bg-texture--float-2{% else %}bg-texture--dots bg-texture--gradient-2{% endif %}" style="{% if section.settings.background_type == 'gradient' %}background: var(--g-brand);{% else %}background-color: {{ section.settings.background_color }};{% endif %}">
  <div class="container">
    <!-- Section Header (optional) -->
    {% if section.settings.heading != blank %}
      <div class="text-center mb-5 animate-fade-up">
        <h2 class="an-stats-bar__heading" style="color: {{ section.settings.text_color }}; font-size: var(--fs-h2); font-weight: 500;">
          {{ section.settings.heading }}
        </h2>
      </div>
    {% endif %}

    <!-- Stats Grid -->
    <div class="an-stats-bar__grid">
      {% assign stat_count = section.blocks.size %}
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'stat' %}
            <div class="an-stats-bar__item animate-fade-up" style="animation-delay: {{ forloop.index | times: 0.1 }}s;" {{ block.shopify_attributes }}>
              <!-- Icon -->
              {% if block.settings.show_icon %}
                <div class="an-stats-bar__icon" style="color: {{ section.settings.icon_color }};">
                  {% case block.settings.icon_type %}
                    {% when 'users' %}
                      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M34 38V34C34 31.8783 33.1571 29.8434 31.6569 28.3431C30.1566 26.8429 28.1217 26 26 26H14C11.8783 26 9.84344 26.8429 8.34315 28.3431C6.84285 29.8434 6 31.8783 6 34V38M40 38V34C39.9987 32.2275 39.4087 30.5055 38.3227 29.1046C37.2368 27.7037 35.7163 26.7031 34 26.27M28 10.27C29.7207 10.7013 31.2463 11.7025 32.3365 13.1052C33.4267 14.5078 34.0195 16.2327 34.0195 18.01C34.0195 19.7873 33.4267 21.5122 32.3365 22.9148C31.2463 24.3175 29.7207 25.3187 28 25.75M26 18C26 22.4183 22.4183 26 18 26C13.5817 26 10 22.4183 10 18C10 13.5817 13.5817 10 18 10C22.4183 10 26 13.5817 26 18Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    {% when 'heart' %}
                      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M41.6 13.0998C40.6536 11.1586 39.3196 9.44617 37.687 8.07385C36.0544 6.70154 34.1616 5.69897 32.1371 5.13011C30.1126 4.56126 27.9998 4.43818 25.92 4.76878C23.8403 5.09938 21.8397 5.87741 20.04 7.05978C18.6809 6.11498 17.1627 5.41498 15.5576 4.99303C13.9525 4.57108 12.2863 4.43434 10.6252 4.58931C8.96399 4.74428 7.33414 5.18867 5.81003 5.90398C4.28591 6.6193 2.89216 7.59451 1.69244 8.78481C0.492716 9.9751 -0.494274 11.3616 -1.22419 12.8804C-1.95411 14.3991 -2.4165 16.0258 -2.59414 17.6855C-2.77178 19.3451 -2.66235 21.0112 -2.27 22.6265C-1.87765 24.2419 -1.20876 25.7806 -0.292002 27.1698L19.308 46.7698C19.4909 46.9526 19.7089 47.0964 19.9489 47.1927C20.189 47.2889 20.446 47.3357 20.7048 47.3302C20.9636 47.3247 21.2186 47.267 21.4545 47.1606C21.6904 47.0542 21.9024 46.9012 22.078 46.7106L22.112 46.6718L41.696 26.6878C42.5341 25.8028 43.1995 24.769 43.6586 23.6393C44.1178 22.5097 44.3631 21.3044 44.3827 20.0856C44.4023 18.8668 44.1958 17.6544 43.7729 16.5107C43.35 15.367 42.718 14.3119 41.908 13.3998L41.6 13.0998Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    {% when 'book' %}
                      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 6C8 4.89543 8.89543 4 10 4H38C39.1046 4 40 4.89543 40 6V42L24 34L8 42V6Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 16H32M16 24H32" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    {% when 'star' %}
                      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M24 4L29.594 17.476L44 19.488L34 29.232L36.376 43.56L24 36.476L11.624 43.56L14 29.232L4 19.488L18.406 17.476L24 4Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    {% when 'clock' %}
                      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M24 12V24L32 28" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    {% when 'custom' %}
                      {% if block.settings.custom_icon != blank %}
                        <img src="{{ block.settings.custom_icon | image_picker_url: 'icon-placeholder.png' }}" alt="" width="48" height="48">
                      {% else %}
                        <!-- Placeholder custom icon -->
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <rect x="8" y="8" width="32" height="32" rx="4" stroke="currentColor" stroke-width="3" stroke-dasharray="4 4"/>
                          <path d="M20 28L24 20L28 28M18 32H30" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      {% endif %}
                  {% endcase %}
                </div>
              {% endif %}

              <!-- Number -->
              <div class="an-stats-bar__number" style="color: {{ section.settings.number_color }};">
                <span class="an-stats-bar__value" data-target="{{ block.settings.number }}" data-suffix="{{ block.settings.suffix }}">0</span>
                <span class="an-stats-bar__suffix">{{ block.settings.suffix }}</span>
              </div>

              <!-- Label -->
              <div class="an-stats-bar__label" style="color: {{ section.settings.label_color }};">
                {{ block.settings.label }}
              </div>

              <!-- Description (optional) -->
              {% if block.settings.description != blank %}
                <div class="an-stats-bar__description" style="color: {{ section.settings.description_color }};">
                  {{ block.settings.description }}
                </div>
              {% endif %}
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</section>

<style>
  .an-stats-bar {
    position: relative;
    overflow: hidden;
  }

  .an-stats-bar__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 3rem;
    max-width: 1000px;
    margin: 0 auto;
  }

  .an-stats-bar__item {
    text-align: center;
    position: relative;
  }
  
  /* Decorative accent behind stat */
  .an-stats-bar__item::before {
    content: '';
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 120px;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M60,20 Q80,20 80,40 T60,60 T40,40 T60,20' fill='none' stroke='%235E3BFF' stroke-width='0.5' opacity='0.2'/%3E%3Cpath d='M60,30 Q70,30 70,40 T60,50 T50,40 T60,30' fill='%23FFE86B' fill-opacity='0.05'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-size: contain;
    pointer-events: none;
    z-index: 0;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .an-stats-bar__item:hover::before {
    opacity: 1;
  }

  .an-stats-bar__icon {
    margin-bottom: 1.5rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 80px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 1;
    transition: transform 0.3s ease;
  }
  
  .an-stats-bar__item:hover .an-stats-bar__icon {
    transform: scale(1.05);
  }

  .an-stats-bar__number {
    font-size: var(--fs-display);
    font-weight: var(--fw-bold);
    line-height: 1;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 0.25rem;
  }

  .an-stats-bar__suffix {
    font-size: var(--fs-h1);
    font-weight: var(--fw-medium);
  }

  .an-stats-bar__label {
    font-size: var(--fs-body);
    font-weight: var(--fw-semibold);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .an-stats-bar__description {
    font-size: var(--fs-body-sm);
    opacity: 0.9;
    max-width: 250px;
    margin: 0 auto;
    line-height: 1.4;
  }

  /* Dark background adjustments */
  .an-stats-bar[style*="--g-brand"] .an-stats-bar__icon,
  .an-stats-bar[style*="#5E3BFF"] .an-stats-bar__icon,
  .an-stats-bar[style*="#4025E0"] .an-stats-bar__icon {
    background: rgba(255, 255, 255, 0.15);
  }

  /* Mobile Styles */
  @media (max-width: 767px) {
    .an-stats-bar__grid {
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 2rem;
    }

    .an-stats-bar__icon {
      width: 60px;
      height: 60px;
      margin-bottom: 1rem;
    }

    .an-stats-bar__icon svg {
      width: 32px;
      height: 32px;
    }

    .an-stats-bar__number {
      font-size: 2rem;
    }

    .an-stats-bar__suffix {
      font-size: 1.5rem;
    }

    .an-stats-bar__label {
      font-size: var(--fs-body);
    }

    .an-stats-bar__description {
      font-size: var(--fs-body-xs);
    }
  }

  /* Animation classes */
  .an-stats-bar__value.counting {
    animation: pulse 0.3s ease-out;
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const statsSection = document.querySelector('#shopify-section-{{ section.id }}');
    const counters = statsSection.querySelectorAll('.an-stats-bar__value');
    const animationDuration = 2000; // 2 seconds
    let hasAnimated = false;

    function animateCounters() {
      if (hasAnimated) return;
      
      counters.forEach(counter => {
        const target = parseInt(counter.dataset.target);
        const increment = target / (animationDuration / 16); // 60fps
        let current = 0;
        
        const updateCounter = () => {
          current += increment;
          
          if (current < target) {
            counter.textContent = Math.floor(current).toLocaleString();
            requestAnimationFrame(updateCounter);
          } else {
            counter.textContent = target.toLocaleString();
            counter.classList.add('counting');
            setTimeout(() => counter.classList.remove('counting'), 300);
          }
        };
        
        updateCounter();
      });
      
      hasAnimated = true;
    }

    // Intersection Observer for scroll-triggered animation
    const observerOptions = {
      threshold: 0.5,
      rootMargin: '0px 0px -100px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounters();
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    observer.observe(statsSection);
  });
</script>

{% schema %}
{
  "name": "Content - Stats Bar",
  "elements": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Our Impact"
    },
    {
      "type": "select",
      "id": "background_type",
      "label": "Background Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid Color"
        },
        {
          "value": "gradient",
          "label": "Brand Gradient"
        }
      ],
      "default": "gradient"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#5E3BFF",
      "info": "Used when 'Solid Color' is selected"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Heading Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "number_color",
      "label": "Number Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description Color",
      "default": "rgba(255, 255, 255, 0.8)"
    }
  ],
  "blocks": [
    {
      "type": "stat",
      "name": "Content - Stats Bar",
      "limit": 4,
      "elements": [
        {
          "type": "checkbox",
          "id": "show_icon",
          "label": "Show Icon",
          "default": true
        },
        {
          "type": "select",
          "id": "icon_type",
          "label": "Icon Type",
          "options": [
            {
              "value": "users",
              "label": "Users"
            },
            {
              "value": "heart",
              "label": "Heart"
            },
            {
              "value": "book",
              "label": "Book"
            },
            {
              "value": "star",
              "label": "Star"
            },
            {
              "value": "clock",
              "label": "Clock"
            },
            {
              "value": "custom",
              "label": "Custom Image"
            }
          ],
          "default": "users"
        },
        {
          "type": "image_picker",
          "id": "custom_icon",
          "label": "Custom Icon",
          "info": "Used when 'Custom Image' is selected above"
        },
        {
          "type": "text",
          "id": "number",
          "label": "Number",
          "default": "100000"
        },
        {
          "type": "text",
          "id": "suffix",
          "label": "Number Suffix",
          "default": "+",
          "info": "e.g., '+', 'K', '%'"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Parents Helped"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Description (optional)",
          "default": "Since 2019"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Content - Stats Bar",
      "category": "Content",
      "description": "Animated statistics to showcase impact",
      "blocks": [
        {
          "type": "stat",
          "settings": {
            "show_icon": true,
            "icon_type": "users",
            "number": "100000",
            "suffix": "+",
            "label": "Parents Helped",
            "description": "Across 50+ countries"
          }
        },
        {
          "type": "stat",
          "settings": {
            "show_icon": true,
            "icon_type": "clock",
            "number": "17",
            "suffix": "+",
            "label": "Years Experience",
            "description": "As a licensed therapist"
          }
        },
        {
          "type": "stat",
          "settings": {
            "show_icon": true,
            "icon_type": "star",
            "number": "95",
            "suffix": "%",
            "label": "Star Rating",
            "description": "From thousands of reviews"
          }
        },
        {
          "type": "stat",
          "settings": {
            "show_icon": true,
            "icon_type": "book",
            "number": "3",
            "suffix": "",
            "label": "Bestselling Books",
            "description": "Award-winning resources"
          }
        }
      ]
    }
  ]
}
{% endschema %}