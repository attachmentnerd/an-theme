{% comment %}
  Modern Course Layout Section
  Complete redesign matching the Discovery platform style
{% endcomment %}

<style>
/* Reset and Base Styles */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: #F8F9FA;
  color: #1A1A1A;
}

/* Hide default Kajabi elements */
.header,
.footer,
.breadcrumb,
.section--global > .container {
  display: none !important;
}

/* Modern Layout Container */
.modern-course-layout {
  display: flex;
  min-height: 100vh;
  width: 100%;
  background: #F8F9FA;
}

/* Sidebar Styles */
.modern-sidebar {
  width: 280px;
  background: #FFFFFF;
  border-right: 1px solid #E5E7EB;
  height: 100vh;
  position: sticky;
  top: 0;
  overflow-y: auto;
  flex-shrink: 0;
}

.sidebar-header {
  padding: 24px;
  border-bottom: 1px solid #E5E7EB;
}

.sidebar-logo {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  color: #1A1A1A;
  font-size: 20px;
  font-weight: 700;
}

.sidebar-logo svg {
  width: 32px;
  height: 32px;
  background: #0066FF;
  color: white;
  padding: 6px;
  border-radius: 8px;
}

/* Course Navigation */
.course-navigation {
  padding: 16px;
}

.nav-section {
  margin-bottom: 32px;
}

.nav-section-title {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  color: #6B7280;
  margin-bottom: 12px;
  letter-spacing: 0.5px;
}

.nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.nav-item {
  margin-bottom: 4px;
}

.nav-link {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  border-radius: 8px;
  color: #374151;
  text-decoration: none;
  font-size: 14px;
  transition: all 0.2s ease;
  position: relative;
}

.nav-link:hover {
  background: #F3F4F6;
  color: #1A1A1A;
}

.nav-link.active {
  background: #EBF5FF;
  color: #0066FF;
  font-weight: 600;
}

.nav-link.completed::before {
  content: '✓';
  position: absolute;
  left: -20px;
  color: #10B981;
  font-weight: 700;
}

.nav-duration {
  font-size: 12px;
  color: #9CA3AF;
}

/* Main Content Area */
.modern-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  width: calc(100% - 280px);
  min-width: 0;
}

/* Top Bar */
.modern-topbar {
  background: #FFFFFF;
  border-bottom: 1px solid #E5E7EB;
  padding: 16px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
}

.topbar-nav {
  display: flex;
  align-items: center;
  gap: 24px;
}

.topbar-link {
  color: #6B7280;
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: color 0.2s ease;
}

.topbar-link:hover {
  color: #1A1A1A;
}

.topbar-link.active {
  color: #0066FF;
}

.topbar-user {
  display: flex;
  align-items: center;
  gap: 12px;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
}

.user-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Content Container */
.modern-content {
  flex: 1;
  padding: 32px;
  max-width: 1200px;
  margin: 0 auto;
  width: 100%;
}

/* Video Player Section */
.video-section {
  background: #FFFFFF;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  margin-bottom: 32px;
}

.video-player {
  position: relative;
  padding-bottom: 56.25%;
  background: #000;
}

.video-player iframe,
.video-player video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* Video Controls */
.video-controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  background: #F9FAFB;
  border-top: 1px solid #E5E7EB;
}

.video-nav {
  display: flex;
  align-items: center;
  gap: 12px;
}

.video-nav-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border: 1px solid #E5E7EB;
  background: #FFFFFF;
  color: #374151;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s ease;
  cursor: pointer;
}

.video-nav-btn:hover {
  background: #F3F4F6;
  border-color: #0066FF;
  color: #0066FF;
}

.video-nav-btn.primary {
  background: #0066FF;
  color: white;
  border-color: #0066FF;
}

.video-nav-btn.primary:hover {
  background: #0052CC;
  border-color: #0052CC;
}

.video-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Video Info */
.video-info {
  padding: 24px;
}

.video-title {
  font-size: 24px;
  font-weight: 700;
  color: #1A1A1A;
  margin: 0 0 12px 0;
}

.video-meta {
  display: flex;
  align-items: center;
  gap: 24px;
  font-size: 14px;
  color: #6B7280;
}

.video-meta-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Video Carousel */
.video-carousel {
  margin-top: 32px;
}

.carousel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.carousel-title {
  font-size: 18px;
  font-weight: 600;
  color: #1A1A1A;
}

.carousel-controls {
  display: flex;
  gap: 8px;
}

.carousel-btn {
  width: 36px;
  height: 36px;
  border: 1px solid #E5E7EB;
  background: #FFFFFF;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.carousel-btn:hover:not(:disabled) {
  background: #0066FF;
  border-color: #0066FF;
  color: white;
}

.carousel-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.carousel-container {
  position: relative;
  overflow: hidden;
}

.carousel-track {
  display: flex;
  gap: 16px;
  transition: transform 0.3s ease;
}

.carousel-item {
  flex: 0 0 280px;
  background: #FFFFFF;
  border: 1px solid #E5E7EB;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
}

.carousel-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-color: #0066FF;
}

.carousel-item.active {
  border-color: #0066FF;
  box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
}

.carousel-thumbnail {
  position: relative;
  padding-bottom: 56.25%;
  background: #F3F4F6;
}

.carousel-thumbnail img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.carousel-play {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 48px;
  height: 48px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.carousel-item:hover .carousel-play {
  opacity: 1;
}

.carousel-duration {
  position: absolute;
  bottom: 8px;
  right: 8px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.carousel-info {
  padding: 12px;
}

.carousel-video-title {
  font-size: 14px;
  font-weight: 600;
  color: #1A1A1A;
  margin: 0 0 4px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.carousel-meta {
  font-size: 12px;
  color: #6B7280;
}

/* Course Progress */
.course-progress {
  background: #FFFFFF;
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 32px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.progress-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.progress-title {
  font-size: 16px;
  font-weight: 600;
  color: #1A1A1A;
}

.progress-percentage {
  font-size: 24px;
  font-weight: 700;
  color: #0066FF;
}

.progress-bar {
  height: 8px;
  background: #E5E7EB;
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: #0066FF;
  border-radius: 4px;
  transition: width 0.3s ease;
}

/* Downloads Section */
.downloads-section {
  background: #FFFFFF;
  border-radius: 12px;
  padding: 24px;
  margin-top: 32px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.downloads-title {
  font-size: 18px;
  font-weight: 600;
  color: #1A1A1A;
  margin: 0 0 16px 0;
}

.download-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: #F9FAFB;
  border: 1px solid #E5E7EB;
  border-radius: 8px;
  margin-bottom: 8px;
  text-decoration: none;
  color: #374151;
  transition: all 0.2s ease;
}

.download-item:hover {
  background: #F3F4F6;
  border-color: #0066FF;
  color: #0066FF;
}

.download-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.download-icon {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .modern-course-layout {
    flex-direction: column;
  }
  
  .modern-sidebar {
    width: 100%;
    height: auto;
    position: relative;
    display: none;
  }
  
  .modern-sidebar.mobile-active {
    display: block;
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 1000;
  }
  
  .modern-main {
    width: 100%;
  }
  
  .modern-content {
    padding: 16px;
  }
  
  .mobile-menu-btn {
    display: block;
  }
  
  .carousel-item {
    flex: 0 0 240px;
  }
}

/* Hide mobile menu button on desktop */
.mobile-menu-btn {
  display: none;
}

@media (max-width: 768px) {
  .mobile-menu-btn {
    display: block;
  }
}
</style>

<div class="modern-course-layout">
  <!-- Sidebar -->
  <aside class="modern-sidebar" id="modernSidebar">
    <div class="sidebar-header">
      <a href="/products" class="sidebar-logo">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
        </svg>
        <span>DISCOVERY</span>
      </a>
    </div>
    
    <nav class="course-navigation">
      <!-- Course Title -->
      <div class="nav-section">
        <h3 class="nav-section-title">{{ product.title | default: 'Learn How to Ipsum' }}</h3>
        <div class="course-progress">
          <div class="progress-header">
            <span class="progress-title">Your Progress</span>
            <span class="progress-percentage">{{ product.progress_percentage | default: 37 }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: {{ product.progress_percentage | default: 37 }}%"></div>
          </div>
        </div>
      </div>
      
      <!-- Course Modules -->
      {% for category in product.categories %}
        <div class="nav-section">
          <h3 class="nav-section-title">{{ category.title | default: 'Introduction to Ipsum' }}</h3>
          <ul class="nav-list">
            {% for module_post in category.posts %}
              <li class="nav-item">
                <a href="{{ module_post.url }}" 
                   class="nav-link {% if post.id == module_post.id %}active{% endif %} {% if module_post.completed %}completed{% endif %}">
                  <span>{{ module_post.title }}</span>
                  {% if module_post.video_duration %}
                    <span class="nav-duration">{{ module_post.video_duration }}</span>
                  {% else %}
                    <span class="nav-duration">{{ forloop.index }}0 min</span>
                  {% endif %}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    </nav>
  </aside>
  
  <!-- Main Content -->
  <main class="modern-main">
    <!-- Top Bar -->
    <div class="modern-topbar">
      <div class="topbar-nav">
        <button class="mobile-menu-btn video-nav-btn" onclick="toggleSidebar()">
          ☰
        </button>
        <a href="/dashboard" class="topbar-link">DASHBOARD</a>
        <a href="/categories" class="topbar-link active">CATEGORIES</a>
        <a href="/announcements" class="topbar-link">ANNOUNCEMENTS</a>
      </div>
      
      <div class="topbar-user">
        <span>Welcome Back</span>
        <div class="user-avatar">
          {% if customer.avatar_url %}
            <img src="{{ customer.avatar_url }}" alt="{{ customer.name }}">
          {% else %}
            <img src="https://ui-avatars.com/api/?name={{ customer.name | url_encode }}&background=0066FF&color=fff" alt="{{ customer.name }}">
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Content -->
    <div class="modern-content">
      <!-- Video Section -->
      <div class="video-section">
        <!-- Video Player -->
        <div class="video-player">
          {% if post.video_url %}
            <iframe src="{{ post.video_url }}" allowfullscreen></iframe>
          {% else %}
            <img src="https://via.placeholder.com/1280x720/000/fff?text=Video+Player" alt="Video">
          {% endif %}
        </div>
        
        <!-- Video Info -->
        <div class="video-info">
          <h1 class="video-title">{{ post.title }}</h1>
          <div class="video-meta">
            <div class="video-meta-item">
              <span>{{ post.category.title }}</span>
            </div>
            <div class="video-meta-item">
              <span>{{ post.video_duration | default: '5 min' }}</span>
            </div>
            {% if post.completed %}
              <div class="video-meta-item" style="color: #10B981;">
                <span>✓ LESSON COMPLETED</span>
              </div>
            {% endif %}
          </div>
        </div>
        
        <!-- Video Controls -->
        <div class="video-controls">
          <div class="video-nav">
            {% if previous_post %}
              <a href="{{ previous_post.url }}" class="video-nav-btn">
                ← Previous
              </a>
            {% endif %}
            
            {% if next_post %}
              <a href="{{ next_post.url }}" class="video-nav-btn primary">
                Next →
              </a>
            {% endif %}
          </div>
          
          <div class="video-actions">
            {% unless post.completed %}
              <button class="video-nav-btn" onclick="markComplete()">
                ✓ LESSON COMPLETED!
              </button>
            {% endunless %}
            
            <button class="video-nav-btn" onclick="toggleFavorite()">
              ♥ ADD TO FAVORITE
            </button>
          </div>
        </div>
      </div>
      
      <!-- Video Carousel -->
      <div class="video-carousel">
        <div class="carousel-header">
          <h2 class="carousel-title">More Lessons</h2>
          <div class="carousel-controls">
            <button class="carousel-btn" id="carouselPrev" onclick="moveCarousel(-1)">
              ←
            </button>
            <button class="carousel-btn" id="carouselNext" onclick="moveCarousel(1)">
              →
            </button>
          </div>
        </div>
        
        <div class="carousel-container">
          <div class="carousel-track" id="carouselTrack">
            {% for related_post in post.category.posts limit: 8 %}
              <a href="{{ related_post.url }}" 
                 class="carousel-item {% if post.id == related_post.id %}active{% endif %}">
                <div class="carousel-thumbnail">
                  {% if related_post.poster_image_url %}
                    <img src="{{ related_post.poster_image_url }}" alt="{{ related_post.title }}">
                  {% else %}
                    <img src="https://via.placeholder.com/280x157/F3F4F6/6B7280?text=Lesson+{{ forloop.index }}" alt="{{ related_post.title }}">
                  {% endif %}
                  <div class="carousel-play">▶</div>
                  <span class="carousel-duration">{{ related_post.video_duration | default: '5 min' }}</span>
                  {% if related_post.completed %}
                    <div style="position: absolute; top: 8px; right: 8px; background: #10B981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;">✓</div>
                  {% endif %}
                </div>
                <div class="carousel-info">
                  <h3 class="carousel-video-title">{{ related_post.title }}</h3>
                  <div class="carousel-meta">Lesson {{ forloop.index }}</div>
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
      
      <!-- Downloads -->
      {% if post.downloads.size > 0 %}
        <div class="downloads-section">
          <h2 class="downloads-title">📥 {{ post.downloads.size }} Downloads</h2>
          {% for download in post.downloads %}
            <a href="{{ download.url }}" class="download-item" download>
              <div class="download-info">
                <div class="download-icon">📄</div>
                <span>{{ download.title }}</span>
              </div>
              <span>↓</span>
            </a>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </main>
</div>

<script>
// Carousel functionality
let carouselIndex = 0;
const track = document.getElementById('carouselTrack');
const items = track?.querySelectorAll('.carousel-item');
const itemWidth = 296; // 280px + 16px gap

function updateCarousel() {
  if (!track) return;
  const maxIndex = Math.max(0, items.length - Math.floor(track.parentElement.offsetWidth / itemWidth));
  carouselIndex = Math.max(0, Math.min(carouselIndex, maxIndex));
  track.style.transform = `translateX(-${carouselIndex * itemWidth}px)`;
  
  document.getElementById('carouselPrev').disabled = carouselIndex === 0;
  document.getElementById('carouselNext').disabled = carouselIndex >= maxIndex;
}

function moveCarousel(direction) {
  carouselIndex += direction;
  updateCarousel();
}

// Toggle sidebar on mobile
function toggleSidebar() {
  document.getElementById('modernSidebar').classList.toggle('mobile-active');
}

// Mark complete
function markComplete() {
  // Submit form to mark complete
  const form = document.querySelector('form[action*="mark_complete"]');
  if (form) form.submit();
}

// Toggle favorite
function toggleFavorite() {
  // Implement favorite functionality
  alert('Added to favorites!');
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  updateCarousel();
  
  // Handle window resize
  window.addEventListener('resize', updateCarousel);
});
</script>

{% schema %}
{
  "name": "Modern Course Layout",
  "elements": [],
  "presets": [
    {
      "name": "Modern Course Layout",
      "description": "A modern course layout with sidebar navigation and video player",
      "category": "Course"
    }
  ]
}
{% endschema %}