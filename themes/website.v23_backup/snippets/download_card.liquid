{% comment %}
  Download Card Snippet

  Usage examples:
    {% include "download_card", title: "Workbook PDF", description: "Companion guide for Module 2.", href: download.url, icon: "download", label: "Download PDF", meta: "PDF • 2.3 MB", open_in_new: true %}

  Params:
    - title         (required)  Heading text
    - href          (required)  Link URL to file
    - description   (optional)  Supporting copy under title
    - label         (optional)  Button label (default: "Download")
    - icon          (optional)  Icon name from shared/snippets/icon.liquid (default: "download")
    - meta          (optional)  Small file details (e.g., "PDF • 2.3 MB")
    - open_in_new   (optional)  true/false -> target _blank
    - download      (optional)  true/false -> add download attribute
    - bg            (optional)  Background color (default: var(--c-white))
    - accent        (optional)  Accent color for icon/button (default: var(--c-brand-600))
    - id            (optional)  Unique id suffix to scope button color class
    - image         (optional)  Image URL to show on the card (left)
    - image_alt     (optional)  Alt text for the image (accessibility)
    - header        (optional)  Title band text at top of card
    - header_bg     (optional)  Title band background (default: accent)
    - header_color  (optional)  Title band text color (default: #fff)
    - stack         (optional)  true/false -> force vertical stack layout (sidebar)
{% endcomment %}

{% assign card_title = title | default: 'Download' %}
{% assign card_description = description %}
{% assign card_href = href | default: '#' %}
{% assign card_icon = icon | default: 'download' %}
{% assign button_label = label | default: 'Download' %}
{% assign file_meta = meta %}
{% assign bg_color = bg | default: 'var(--c-white)' %}
{% assign accent_color = accent | default: 'var(--c-brand-600)' %}
{% assign card_image = image %}
{% assign card_image_alt = image_alt | default: card_title %}
{% assign header_text = header %}
{% assign header_bg_color = header_bg | default: accent_color %}
{% assign header_text_color = header_color | default: '#ffffff' %}
{% assign is_stack = stack %}

{%- assign uid_base = id | default: card_title -%}
{%- assign uid = uid_base | replace: ' ', '-' | replace: '"', '' | replace: "'", '' | replace: '.', '-' | downcase -%}
{%- if uid == '' -%}
  {%- assign uid = 'download-card' -%}
{%- endif -%}

<style>
  /* Scoped variables hook for per-instance theming */
  .dl-card--{{ uid }} {
    --bg: {{ bg_color }};
    --accent: {{ accent_color }};
  }

  /* Optional image layout: make image ~30% width, content grows, CTA auto */
  .dl-card.dl-card--{{ uid }}.dl-card--has-image {
    display: grid;
    grid-template-columns: 30% 1fr auto;
    align-items: center;
  }

  /* Optional header band: full-width row above content */
  .dl-card.dl-card--{{ uid }}.dl-card--has-header {
    display: grid;
    grid-template-rows: auto 1fr;
    gap: 16px;
  }
  .dl-card.dl-card--{{ uid }}.dl-card--has-header:not(.dl-card--has-image) {
    grid-template-columns: auto 1fr auto; /* icon, content, cta */
    align-items: center;
  }
  .dl-card--{{ uid }} .dl-card__header {
    grid-column: 1 / -1;
    background: {{ header_bg_color }};
    color: {{ header_text_color }};
    padding: 10px 14px;
    border-radius: 10px;
    font-weight: 600;
    line-height: 1.3;
  }

  /* Forced stack layout for narrow sidebars */
  .dl-card.dl-card--{{ uid }}.dl-card--stack {
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: auto auto auto auto;
    gap: 12px;
    align-items: start;
  }
  .dl-card--{{ uid }}.dl-card--stack .dl-card__media {
    width: 100%;
  }
  .dl-card--{{ uid }}.dl-card--stack .dl-card__media-img {
    aspect-ratio: 16 / 9;
    object-fit: contain;
    background: #fff;
  }
  .dl-card--{{ uid }}.dl-card--stack .dl-card__cta {
    width: 100%;
    margin-top: 4px;
  }

  .dl-card--{{ uid }} .dl-card__media {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
    background: color-mix(in srgb, var(--accent) 8%, transparent);
    box-shadow: 0 8px 18px rgba(16, 24, 40, 0.10);
  }
  .dl-card--{{ uid }} .dl-card__media-img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    aspect-ratio: 1 / 1;
    transition: transform var(--motion-duration-fast, .2s) var(--motion-ease-standard, ease), filter var(--motion-duration-fast, .2s) var(--motion-ease-standard, ease);
    filter: none;
  }
  .dl-card--{{ uid }}.dl-card--has-image:hover .dl-card__media-img {
    transform: translateY(-1px);
    filter: brightness(1.02);
  }

  @media (max-width: 640px) {
    .dl-card.dl-card--{{ uid }}.dl-card--has-image {
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .dl-card--{{ uid }} .dl-card__cta {
      width: 100%;
      margin-top: 8px;
    }
    .dl-card--{{ uid }} .dl-card__media-img {
      aspect-ratio: 16 / 9;
      object-fit: contain;
      background: #fff;
    }
  }
</style>

<div class="dl-card dl-card--{{ uid }}{% if card_image %} dl-card--has-image{% endif %}{% if header_text %} dl-card--has-header{% endif %}{% if is_stack %} dl-card--stack{% endif %}">
  {% if header_text %}
    <div class="dl-card__header">{{ header_text }}</div>
  {% endif %}
  {% if card_image %}
    <div class="dl-card__media" aria-hidden="true">
      <img class="dl-card__media-img" src="{{ card_image }}" alt="{{ card_image_alt | escape }}" loading="lazy" decoding="async">
    </div>
  {% else %}
    <div class="dl-card__icon-wrap">
      {% include "icon", icon: card_icon, size: 24, class: 'dl-card__icon', color: 'currentColor', aria_label: 'Download' %}
    </div>
  {% endif %}
  <div class="dl-card__content">
    <h4 class="dl-card__title">{{ card_title }}</h4>
    {% if card_description %}
      <p class="dl-card__desc">{{ card_description }}</p>
    {% endif %}
    {% if file_meta %}
      <div class="dl-card__meta">{{ file_meta }}</div>
    {% endif %}
  </div>
  <div class="dl-card__cta">
    <a href="{{ card_href }}"
      class="dl-btn"
      {% if open_in_new %}target="_blank" rel="noopener noreferrer"{% endif %}
      {% if download %}download{% endif %}
    >
      {% include "icon", icon: card_icon, size: 18, class: 'dl-btn__icon', color: 'currentColor', aria_label: '' %}
      {{ button_label }}
    </a>
  </div>
</div>


