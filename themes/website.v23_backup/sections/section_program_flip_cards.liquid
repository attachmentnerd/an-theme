{% comment %}
  Secure Parenting Program — Flip Cards (Shared)
  - Modern, bold, token-driven design
  - Accessible flip interaction (click, keyboard; reduced-motion fallback)
  - Responsive auto-fit grid; shared across website + landing
  - Each block = module with front (emoji/icon + title) and back (one‑liner + CTA)
{% endcomment %}

{% assign s_id = section.id %}

<section id="program-flip-{{ s_id }}" class="an-section an-theme">
  <div class="pfp-container">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <header class="pfp-head">
        {% if section.settings.eyebrow != blank %}
          <p class="pfp-eyebrow">{{ section.settings.eyebrow }}</p>
        {% endif %}
        {% if section.settings.heading != blank %}
          <h2 class="pfp-title">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="pfp-sub">{{ section.settings.subheading }}</p>
        {% endif %}
      </header>
    {% endif %}

    <div class="pfp-grid" style="gap: {{ section.settings.card_gap }}px; grid-template-columns: repeat(auto-fit, minmax({{ section.settings.card_min_width }}, 1fr));">
      {% for block in section.blocks %}
        {% assign front_icon = block.settings.emoji | default: '🔒' %}
        <article class="pfp-card" data-inited="0" {{ block.shopify_attributes }}>
          <button class="pfp-inner" type="button" aria-expanded="false" aria-controls="pfp-panel-{{ s_id }}-{{ forloop.index }}">
            <span class="sr-only">Toggle details for {{ block.settings.title | default: 'Module' }}</span>
            <div class="pfp-face pfp-front">
              <div class="pfp-icon" aria-hidden="true">{{ front_icon }}</div>
              <div class="pfp-front-body">
                <div class="pfp-kicker">{{ block.settings.kicker | default: block.settings.week_label }}</div>
                <h3 class="pfp-front-title">{{ block.settings.title | default: 'Module title' }}</h3>
                {% if block.settings.front_hint != blank %}
                  <p class="pfp-front-hint">{{ block.settings.front_hint }}</p>
                {% endif %}
              </div>
              <div class="pfp-flip-cta" aria-hidden="true">{{ section.settings.flip_text }}</div>
            </div>
            <div id="pfp-panel-{{ s_id }}-{{ forloop.index }}" class="pfp-face pfp-back" style="--pfp-bg:url('{{ block.settings.background_image | image_picker_url: '1200x800' }}'); --pfp-grad: {{ section.settings.back_gradient | default: 'linear-gradient(160deg, rgba(11,16,32,.84), rgba(11,16,32,.66))' }};">
              <div class="pfp-back-media" aria-hidden="true"></div>
              <div class="pfp-back-body">
                {% if block.settings.back_title != blank %}
                  <div class="pfp-back-title">{{ block.settings.back_title }}</div>
                {% endif %}
                {% if block.settings.description != blank %}
                  <p class="pfp-desc">{{ block.settings.description }}</p>
                {% endif %}
                {% if block.settings.url != blank and block.settings.cta_text != blank %}
                  <a href="{{ block.settings.url }}" class="pfp-btn pfp-btn--block" {% if block.settings.new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}>{{ block.settings.cta_text }}</a>
                {% endif %}
              </div>
            </div>
          </button>
        </article>
      {% endfor %}
    </div>
  </div>

  <style>
    /* Container */
    #program-flip-{{ s_id }} .pfp-container{max-width:1100px; margin:0 auto; padding:48px 20px}
    #program-flip-{{ s_id }} .pfp-head{text-align:center; margin-bottom:20px}
    #program-flip-{{ s_id }} .pfp-eyebrow{display:inline-block; font-size:.9rem; color:var(--c-brand-600); background:var(--c-brand-100); border:1px solid var(--c-brand-100); padding:6px 12px; border-radius:9999px; margin:0 0 10px}
    #program-flip-{{ s_id }} .pfp-title{font-size:calc(var(--fs-h2) + 2px); font-weight:700; color:var(--c-ink-900); margin:0 0 8px; letter-spacing:-.01em}
    #program-flip-{{ s_id }} .pfp-sub{color:var(--c-ink-700); max-width:740px; margin:0 auto}

    /* Grid */
    #program-flip-{{ s_id }} .pfp-grid{display:grid}

    /* Card shell */
    #program-flip-{{ s_id }} .pfp-card{perspective:1200px}
    #program-flip-{{ s_id }} .pfp-inner{position:relative; width:100%; border:1px solid var(--border-light); border-radius:16px; background:var(--c-white); box-shadow:var(--shadow-card); cursor:pointer; padding:0; text-align:left; -webkit-tap-highlight-color:transparent}
    #program-flip-{{ s_id }} .pfp-inner:focus{outline:2px solid var(--c-brand-600); outline-offset:2px}

    /* Faces */
    #program-flip-{{ s_id }} .pfp-face{min-height:220px; display:grid; grid-template-columns:72px 1fr auto; gap:16px; align-items:center; padding:18px; border-radius:16px; backface-visibility:hidden; transform-style:preserve-3d}
    #program-flip-{{ s_id }} .pfp-front{background:linear-gradient(145deg, rgba(94,59,255,.06), rgba(24,213,228,.06))}
    #program-flip-{{ s_id }} .pfp-back{position:absolute; inset:0; background:#0f1020; color:#fff; transform:rotateY(180deg);}

    /* 3D flip */
    #program-flip-{{ s_id }} .pfp-inner{transform-style:preserve-3d; transition:transform var(--motion-duration-base) var(--motion-ease-standard)}
    #program-flip-{{ s_id }} .pfp-inner[aria-expanded="true"]{transform:rotateY(180deg)}
    #program-flip-{{ s_id }} .pfp-front-body{min-width:0}
    #program-flip-{{ s_id }} .pfp-icon{width:56px; height:56px; border-radius:16px; display:grid; place-items:center; font-size:28px; background:#fff; border:1px solid var(--c-brand-100); box-shadow:0 6px 16px rgba(0,0,0,.06)}
    #program-flip-{{ s_id }} .pfp-kicker{font-size:.85rem; color:var(--c-ink-500); margin-bottom:2px}
    #program-flip-{{ s_id }} .pfp-front-title{margin:0; font-size:1.15rem; color:var(--c-ink-900); font-weight:700}
    #program-flip-{{ s_id }} .pfp-front-hint{margin:.25rem 0 0; color:var(--c-ink-700); font-size:.98rem}
    #program-flip-{{ s_id }} .pfp-flip-cta{color:var(--c-brand-600); font-weight:600}

    /* Back */
    /* Back: media overlay */
    #program-flip-{{ s_id }} .pfp-back{overflow:hidden}
    #program-flip-{{ s_id }} .pfp-back-media{position:absolute; inset:0; background-image:var(--pfp-grad), var(--pfp-bg); background-size:cover; background-position:center; filter:saturate(1.05);}
    #program-flip-{{ s_id }} .pfp-back-body{position:relative; z-index:1; display:flex; flex-direction:column; gap:12px; justify-content:flex-end}
    #program-flip-{{ s_id }} .pfp-back-title{font-size:.95rem; opacity:.9}
    #program-flip-{{ s_id }} .pfp-desc{margin:0; line-height:1.5; color:rgba(255,255,255,.95)}
    #program-flip-{{ s_id }} .pfp-btn{display:inline-block; background:var(--g-brand, linear-gradient(135deg, #6757FF 0%, #7B4DFF 100%)); color:#fff; text-decoration:none; font-weight:600; border-radius:12px; padding:12px 16px; box-shadow:var(--glow-brand)}
    #program-flip-{{ s_id }} .pfp-btn--block{display:block; width:100%; text-align:center}

    /* Hover lift on non-touch */
    @media (hover:hover){
      #program-flip-{{ s_id }} .pfp-inner:hover{box-shadow:var(--shadow-lg)}
    }

    /* Reduced motion: reveal via expand/collapse instead of 3D */
    @media (prefers-reduced-motion: reduce){
      #program-flip-{{ s_id }} .pfp-inner{transition:none}
      #program-flip-{{ s_id }} .pfp-front{position:relative}
      #program-flip-{{ s_id }} .pfp-back{position:relative; transform:none; display:none}
      #program-flip-{{ s_id }} .pfp-inner[aria-expanded="true"] .pfp-back{display:block}
      #program-flip-{{ s_id }} .pfp-inner[aria-expanded="true"] .pfp-front{display:none}
    }

    /* Mobile layout */
    @media (max-width: 860px){
      #program-flip-{{ s_id }} .pfp-face{grid-template-columns:1fr; grid-template-rows:auto 1fr auto; align-content:start; min-height:260px}
      #program-flip-{{ s_id }} .pfp-front{grid-template-columns:48px 1fr auto}
      #program-flip-{{ s_id }} .pfp-back{display:flex}
      #program-flip-{{ s_id }} .pfp-back-body{margin-top:auto}
      #program-flip-{{ s_id }} .pfp-icon{width:44px; height:44px; border-radius:12px; font-size:24px}
      #program-flip-{{ s_id }} .pfp-title{font-size:var(--fs-h2)}
    }
  </style>

  <script>
    (function(){
      var root = document.getElementById('program-flip-{{ s_id }}');
      if(!root || root.dataset.inited==='1') return; root.dataset.inited='1';
      var cards = [].slice.call(root.querySelectorAll('.pfp-card'));
      function toggle(btn){
        var expanded = btn.getAttribute('aria-expanded') === 'true';
        // collapse others for clarity on desktop
        cards.forEach(function(c){ var b=c.querySelector('.pfp-inner'); if(b && b!==btn){ b.setAttribute('aria-expanded','false'); }});
        btn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
      }
      cards.forEach(function(card){
        var btn = card.querySelector('.pfp-inner');
        if(!btn) return;
        if(card.dataset.inited==='1') return; card.dataset.inited='1';
        btn.addEventListener('click', function(){ toggle(btn); });
        btn.addEventListener('keydown', function(e){
          if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggle(btn); }
          if(e.key==='Escape'){ btn.setAttribute('aria-expanded','false'); btn.blur(); }
        });
      });
    })();
  </script>
</section>

{% schema %}
{
  "name": "Program – Flip Cards",
  "elements": [
    { "type": "text", "id": "eyebrow", "label": "Eyebrow", "default": "Secure Parenting Program" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Your 6‑Week Secure Path" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Tap to flip each module. Read the promise. Jump in when you’re ready." },
    { "type": "text", "id": "flip_text", "label": "Flip hint text", "default": "Click to flip →" },
    { "type": "range", "id": "card_gap", "label": "Card Gap", "min": 12, "max": 40, "step": 2, "unit": "px", "default": 20 },
    { "type": "text", "id": "card_min_width", "label": "Card min width", "default": "260px" },
    { "type": "text", "id": "back_gradient", "label": "Back gradient CSS", "default": "linear-gradient(160deg, rgba(11,16,32,.84), rgba(11,16,32,.66))" }
  ],
  "blocks": [
    {
      "type": "module",
      "name": "Module Card",
      "elements": [
        { "type": "text", "id": "week_label", "label": "Week label", "default": "Week 1" },
        { "type": "text", "id": "emoji", "label": "Emoji/Icon (single character)", "default": "🔒" },
        { "type": "text", "id": "kicker", "label": "Kicker", "default": "Understand your triggers" },
        { "type": "text", "id": "title", "label": "Front title", "default": "Cracking the Attachment Code" },
        { "type": "text", "id": "front_hint", "label": "Front hint", "default": "Click to flip" },
        { "type": "text", "id": "back_title", "label": "Back label", "default": "You’ll walk away with" },
        { "type": "textarea", "id": "description", "label": "Back description", "default": "A clear 4‑step pattern map and one script to break the spiral when emotions spike." },
        { "type": "image_picker", "id": "background_image", "label": "Back background image" },
        { "type": "action", "id": "url", "label": "Module link", "default": "#" },
        { "type": "text", "id": "cta_text", "label": "CTA text", "default": "Open module →" },
        { "type": "checkbox", "id": "new_tab", "label": "Open in new tab", "default": false }
      ]
    }
  ],
  "presets": [
    {
      "name": "Program – Flip Cards",
      "category": "Program",
      "blocks": [
        {"type":"module","settings":{"week_label":"Week 1","emoji":"🔒","kicker":"Understand your triggers","title":"Week 1: Cracking the Code","front_hint":"Click to flip","back_title":"Breakthrough","description":"A 4‑step pattern map when your survival brain takes over.","cta_text":"Go to module →","url":"#"}},
        {"type":"module","settings":{"week_label":"Week 2","emoji":"🤝","kicker":"Micro‑moments that matter","title":"Week 2: Building Connection","front_hint":"Click to flip","back_title":"Skill","description":"Create daily connection rituals that fit a busy life.","cta_text":"Go to module →","url":"#"}},
        {"type":"module","settings":{"week_label":"Week 3","emoji":"🧯","kicker":"Your C.A.L.M. protocol","title":"Week 3: Hard Moments","front_hint":"Click to flip","back_title":"Protocol","description":"Run C.A.L.M. instead of power struggles when everything’s on fire.","cta_text":"Go to module →","url":"#"}},
        {"type":"module","settings":{"week_label":"Week 4","emoji":"🛡️","kicker":"Boundaries that stick","title":"Week 4: Kind & Firm","front_hint":"Click to flip","back_title":"Boundaries","description":"Hold limits without losing connection.","cta_text":"Go to module →","url":"#"}},
        {"type":"module","settings":{"week_label":"Week 5","emoji":"🔐","kicker":"Safety without fear","title":"Week 5: Connected Protection","front_hint":"Click to flip","back_title":"Safety","description":"Teach safety through connection, not fear.","cta_text":"Go to module →","url":"#"}},
        {"type":"module","settings":{"week_label":"Week 6","emoji":"🛠️","kicker":"Repair that sticks","title":"Week 6: Repair > Perfect","front_hint":"Click to flip","back_title":"Repair","description":"Use the 30% rule and fast repairs to build trust.","cta_text":"Go to module →","url":"#"}}
      ]
    }
  ]
}
{% endschema %}


