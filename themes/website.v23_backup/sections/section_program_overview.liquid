{% comment %}
  Program Overview — Features
  - Layout: Benefits → Modules (timeline) → Audience chips → Included checklist → CTA
  - Scoped CSS + defensive reveal JS; safe fallbacks for tokens
  - Newline-separated lists parsed in Liquid
{% endcomment %}

<section id="program-overview-{{ section.id }}" class="an-section an-theme an-white">
  <div class="an-container">
    <!-- Header -->
    <header class="pov-head an-reveal">
      {% if section.settings.eyebrow != blank %}
        <p class="pov-eyebrow">{{ section.settings.eyebrow }}</p>
      {% endif %}
      {% if section.settings.heading != blank %}
        <h2 class="pov-title">{{ section.settings.heading }}</h2>
      {% endif %}
      {% if section.settings.subheading != blank %}
        <p class="pov-sub">{{ section.settings.subheading }}</p>
      {% endif %}
    </header>

    <!-- Optional media (video/embed) -->
    {% if section.settings.video_embed != blank %}
      <div class="pov-media an-reveal" aria-label="Program overview media">
        {{ section.settings.video_embed }}
      </div>
    {% endif %}

    <!-- Benefits -->
    {% assign benefits = section.settings.benefits | strip | split: '\n' %}
    {% if benefits.size > 0 and benefits[0] != blank %}
    <section class="pov-block an-reveal">
      <h3 class="pov-h3">Why this works</h3>
      <div class="pov-grid pov-benefits">
        {% for line in benefits %}
          {% assign btxt = line | strip %}
          {% if btxt != blank %}
          <article class="pov-card">
            <div class="pov-icon" aria-hidden="true">
              <!-- Spark/heart/check hybrid icon -->
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 2l2 5 5 2-5 2-2 5-2-5-5-2 5-2 2-5z" fill="currentColor" opacity=".25"/>
                <path d="M9.2 12.8l2 2 4.6-4.6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <p class="pov-card-text">{{ btxt }}</p>
          </article>
          {% endif %}
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- Modules timeline -->
    {% assign modules_raw = section.settings.modules | strip | split: '\n' %}
    {% if modules_raw.size > 0 and modules_raw[0] != blank %}
    <section class="pov-block an-reveal">
      <h3 class="pov-h3">What you’ll learn (6‑week path)</h3>
      <div class="pov-timeline" role="list">
        {% for item in modules_raw %}
          {% assign m = item | strip %}
          {% if m != blank %}
            {% assign parts = m | split: '|' %}
            {% assign mtitle = parts[0] | strip %}
            {% assign mdesc = parts[1] | default: '' | strip %}
            <article class="pov-step" role="listitem" aria-label="{{ mtitle }}">
              <div class="pov-step-num">{{ forloop.index }}</div>
              <div class="pov-step-body">
                <div class="pov-step-title">{{ mtitle }}</div>
                {% if mdesc != blank %}<p class="pov-step-desc">{{ mdesc }}</p>{% endif %}
              </div>
            </article>
          {% endif %}
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- Audience chips -->
    {% assign audience = section.settings.audience | strip | split: '\n' %}
    {% if audience.size > 0 and audience[0] != blank %}
    <section class="pov-block an-reveal">
      <h3 class="pov-h3">Made for caregivers who…</h3>
      <div class="pov-chips">
        {% for who in audience %}
          {% assign w = who | strip %}
          {% if w != blank %}
            <span class="pov-chip">{{ w }}</span>
          {% endif %}
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- What's inside checklist -->
    {% assign included = section.settings.included | strip | split: '\n' %}
    {% if included.size > 0 and included[0] != blank %}
    <section class="pov-block an-reveal">
      <h3 class="pov-h3">What’s inside</h3>
      <ul class="pov-list">
        {% for inc in included %}
          {% assign it = inc | strip %}
          {% if it != blank %}
          <li class="pov-list-item">
            <span class="pov-check" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M16.7 5.5l-8.1 8.2L3.3 8.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </span>
            <span>{{ it }}</span>
          </li>
          {% endif %}
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <!-- CTA -->
    <div class="pov-cta an-reveal">
      {% if section.settings.cta_secondary_text != blank and section.settings.cta_secondary_url != blank %}
        <a href="{{ section.settings.cta_secondary_url }}" class="an-btn-secondary" data-evt="pov_cta" data-label="secondary">{{ section.settings.cta_secondary_text }}</a>
      {% endif %}
      {% if section.settings.cta_primary_text != blank and section.settings.cta_primary_url != blank %}
        <a href="{{ section.settings.cta_primary_url }}" class="an-btn-primary" data-evt="pov_cta" data-label="primary">{{ section.settings.cta_primary_text }}</a>
      {% endif %}
    </div>
  </div>

  <!-- Scoped Styles -->
  <style>
    /* Fail-open reveal: visible unless JS sets .an-js */
    #program-overview-{{ section.id }} .an-reveal{opacity:1; transform:none}
    html.an-js #program-overview-{{ section.id }} .an-reveal{
      opacity:0; transform:translateY(28px);
      transition:opacity .5s cubic-bezier(.2,.7,.2,1), transform .5s cubic-bezier(.2,.7,.2,1);
    }
    html.an-js #program-overview-{{ section.id }} .an-reveal.is-in{opacity:1; transform:none}

    /* Reduced motion: disable transitions */
    @media (prefers-reduced-motion: reduce){
      html.an-js #program-overview-{{ section.id }} .an-reveal{transition:none !important; transform:none !important; opacity:1 !important}
    }

    /* Container */
    #program-overview-{{ section.id }} .an-container{max-width:1100px; margin:0 auto; padding:56px 20px}

    /* Header */
    #program-overview-{{ section.id }} .pov-head{
      text-align:center; margin-bottom:28px; position:relative;
    }
    #program-overview-{{ section.id }} .pov-eyebrow{
      display:inline-block; font-size:.9rem; color:var(--c-brand-600, #5E3BFF);
      background:rgba(94,59,255,.08); border:1px solid var(--c-brand-100, #E9E6FF);
      padding:6px 12px; border-radius:9999px; margin:0 0 10px;
    }
    #program-overview-{{ section.id }} .pov-title{
      color:var(--c-ink-900, #1B1B29); font-weight:600; font-size:2rem; line-height:1.15; margin:0 0 10px;
    }
    #program-overview-{{ section.id }} .pov-sub{
      color:var(--c-ink-700, #323346); font-size:1.05rem; max-width:720px; margin:0 auto;
    }

    /* Optional media */
    #program-overview-{{ section.id }} .pov-media{
      margin:20px auto 8px; max-width:860px; border-radius:16px; overflow:hidden;
      box-shadow:0 12px 24px rgba(0,0,0,.08);
      background:var(--c-white, #fff);
    }
    #program-overview-{{ section.id }} .pov-media iframe,
    #program-overview-{{ section.id }} .pov-media video{display:block; width:100%; height:auto}

    /* Blocks */
    #program-overview-{{ section.id }} .pov-block{margin-top:32px}
    #program-overview-{{ section.id }} .pov-h3{
      font-size:1.25rem; color:var(--c-ink-900, #1B1B29); margin:0 0 12px; font-weight:600;
    }

    /* Cards — benefits */
    #program-overview-{{ section.id }} .pov-grid{
      display:grid; gap:12px; grid-template-columns:repeat(2, minmax(0,1fr));
    }
    @media (max-width: 720px){
      #program-overview-{{ section.id }} .pov-grid{grid-template-columns:1fr}
    }
    #program-overview-{{ section.id }} .pov-card{
      background:var(--c-white, #fff); border:1px solid var(--c-brand-100, #E9E6FF);
      border-radius:16px; padding:18px 16px; display:flex; gap:12px; align-items:flex-start;
      box-shadow:0 4px 12px rgba(0,0,0,.05);
    }
    #program-overview-{{ section.id }} .pov-icon{
      width:36px; height:36px; border-radius:10px; flex:0 0 36px;
      display:grid; place-items:center; color:var(--c-brand-600, #5E3BFF);
      background:linear-gradient(145deg, rgba(94,59,255,.12), rgba(24,213,228,.12));
    }
    #program-overview-{{ section.id }} .pov-card-text{color:var(--c-ink-700, #323346); margin:2px 0 0; font-size:1rem}

    /* Timeline (modules) */
    #program-overview-{{ section.id }} .pov-timeline{
      display:flex; gap:12px; overflow-x:auto; padding-bottom:6px;
      scroll-snap-type:x mandatory;
    }
    #program-overview-{{ section.id }} .pov-step{
      min-width:240px; flex:0 0 auto; scroll-snap-align:start;
      background:var(--c-white, #fff); border:1px solid var(--c-brand-100, #E9E6FF); border-radius:16px; padding:14px;
      box-shadow:0 4px 12px rgba(0,0,0,.05); display:flex; gap:12px; align-items:flex-start;
    }
    #program-overview-{{ section.id }} .pov-step-num{
      flex:0 0 36px; height:36px; border-radius:9999px; display:grid; place-items:center; font-weight:700;
      color:#fff; background:var(--g-brand, linear-gradient(135deg, #6757FF 0%, #7B4DFF 100%)); box-shadow:0 0 12px rgba(105,78,255,.25);
    }
    #program-overview-{{ section.id }} .pov-step-title{color:var(--c-ink-900, #1B1B29); font-weight:600; font-size:1.02rem}
    #program-overview-{{ section.id }} .pov-step-desc{color:var(--c-ink-500, #6E6F7B); font-size:.95rem; margin:.25rem 0 0}

    /* Chips (audience) */
    #program-overview-{{ section.id }} .pov-chips{
      display:flex; flex-wrap:wrap; gap:8px;
    }
    #program-overview-{{ section.id }} .pov-chip{
      display:inline-block; padding:8px 14px; border-radius:9999px; font-size:.95rem; color:var(--c-ink-700, #323346);
      background:var(--c-brand-100, #E9E6FF);
      border:1px solid rgba(94,59,255,.18);
    }

    /* Included list */
    #program-overview-{{ section.id }} .pov-list{list-style:none; padding:0; margin:0; display:grid; gap:10px}
    #program-overview-{{ section.id }} .pov-list-item{display:flex; align-items:flex-start; gap:10px; color:var(--c-ink-700, #323346)}
    #program-overview-{{ section.id }} .pov-check{
      color:var(--c-brand-600, #5E3BFF); background:rgba(94,59,255,.08); border-radius:6px; width:22px; height:22px; display:grid; place-items:center; flex:0 0 22px;
    }

    /* CTA */
    #program-overview-{{ section.id }} .pov-cta{
      display:flex; gap:10px; justify-content:center; align-items:center; margin-top:22px; flex-wrap:wrap;
    }
    #program-overview-{{ section.id }} .an-btn-primary{
      background:var(--g-brand, linear-gradient(135deg, #6757FF 0%, #7B4DFF 100%)); color:#fff; border-radius:9999px; padding:12px 24px; font-weight:600;
      box-shadow:0 0 0 2px rgba(255,255,255,.25) inset, 0 6px 16px rgba(94,59,255,.35);
      transition:transform .15s ease, box-shadow .15s ease;
      text-decoration:none; display:inline-block; min-height:44px;
    }
    #program-overview-{{ section.id }} .an-btn-primary:hover{transform:translateY(-2px)}
    #program-overview-{{ section.id }} .an-btn-secondary{
      background:#fff; color:var(--c-brand-600, #5E3BFF); border:1px solid var(--c-brand-100, #E9E6FF); border-radius:12px; padding:10px 18px; text-decoration:none; display:inline-block;
      min-height:44px;
    }

    /* Very small phones: a bit tighter horizontal padding */
    @media (max-width: 360px){
      #program-overview-{{ section.id }} .an-container{ padding:48px 16px; }
    }
  </style>

  <!-- Scoped Reveal JS (defensive; works in Kajabi preview) -->
  <script>
    (function(){
      document.documentElement.classList.add('an-js');
      var root = document.getElementById('program-overview-{{ section.id }}');
      if(!root || root.dataset.inited==='1') return; root.dataset.inited='1';

      var items = [].slice.call(root.querySelectorAll('.an-reveal'));
      function showAll(){ items.forEach(function(n){ n.classList.add('is-in'); }); }

      var inEditor =
        location.search.indexOf('preview')>-1 ||
        !!document.querySelector('[data-kajabi-theme-editor],[data-builder],[data-editor]') ||
        (function(){ try { return window.top !== window.self; } catch(e){ return true; } })();

      if('IntersectionObserver' in window && !inEditor){
        var io = new IntersectionObserver(function(entries){
          entries.forEach(function(e){ if(e.isIntersecting){ e.target.classList.add('is-in'); io.unobserve(e.target); }});
        }, {threshold:.2});
        items.forEach(function(n){ io.observe(n); });
        setTimeout(function(){ // timer fallback
          items.filter(function(n){ return !n.classList.contains('is-in'); })
               .forEach(function(n){ n.classList.add('is-in'); });
        }, 1600);
      } else { showAll(); }
    })();
  </script>
</section>

{% schema %}
{
  "name": "Program Overview — Features",
  "elements": [
    { "type": "header", "content": "Header" },
    { "type": "text", "id": "eyebrow", "label": "Eyebrow", "default": "Secure Parenting Program" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Deep science. Practical tools. Real connection." },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Six weeks. Bite‑size videos, scripts you’ll actually use, and monthly live Q&A. It’s not about perfect parenting—it’s about consistent repair and strong bonds." },

    { "type": "header", "content": "Optional Media" },
    { "type": "textarea", "id": "video_embed", "label": "Video or Embed Code", "default": "" },

    { "type": "header", "content": "Benefits (one per line)" },
    { "type": "textarea", "id": "benefits", "label": "Benefits", "default": "Do‑able tools — short scripts for real meltdowns\nCycle‑breaking science — no jargon, no shame\nFits a busy day — watch, try, win (in minutes)" },

    { "type": "header", "content": "Modules (title | one‑line outcome, one per line)" },
    { "type": "textarea", "id": "modules", "label": "Modules", "default": "Cracking the Attachment Code | Understand patterns and start preheating your parenting oven\nCultivating Trust & Connection | Mirror feelings, express delight, project calm confidence\nNavigating the Hard Moments | Run the C.A.L.M. method instead of power struggles\nA Secure Base | Balance nurture + structure; build real resilience (not toughness)\nConnected Protection | Teach safety without fear‑mongering; empower disclosure\nRupture → Repair | Use the 30% rule and fast repairs to stay close" },

    { "type": "header", "content": "Who it’s for (one per line)" },
    { "type": "textarea", "id": "audience", "label": "Audience Chips", "default": "Cycle‑breakers healing their own childhood\nTime‑crunched caregivers who want scripts, not theory\nParents of spicy/strong‑willed kids\nNeurodiversity‑affirming families\nCo‑parents trying to get on the same page" },

    { "type": "header", "content": "What’s Inside (one per line)" },
    { "type": "textarea", "id": "included", "label": "Included Items", "default": "6 core modules (short videos)\nPrintable scripts & one‑liners\nMonthly live Q&A with Eli\nSearchable replays, lifetime access\nWorksheets & micro‑exercises\nPay‑what‑you‑can scholarships" },

    { "type": "header", "content": "CTA" },
    { "type": "text", "id": "cta_primary_text", "label": "Primary CTA Text", "default": "See pricing & join" },
    { "type": "action", "id": "cta_primary_url", "label": "Primary CTA Link", "default": "#pricing-pwyc-slider" },
    { "type": "text", "id": "cta_secondary_text", "label": "Secondary CTA Text", "default": "Explore the full curriculum" },
    { "type": "action", "id": "cta_secondary_url", "label": "Secondary CTA Link", "default": "#curriculum" }
  ],
  "presets": [
    { "name": "Program Overview — Features", "category": "Program" }
  ]
}
{% endschema %}

