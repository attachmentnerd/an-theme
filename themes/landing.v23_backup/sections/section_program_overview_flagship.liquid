{% comment %}
  Program Overview â€” Flagship
  - Elevated visual design: soft background, feature pills with images, module cards grid, dual CTAs
  - Newline-parsed modules: "Title | one-liner" per line
  - Image fields for the three top features; inline SVG fallback if missing
  - Scoped CSS + defensive reveal JS for Kajabi preview
{% endcomment %}

<section id="pov-flagship-{{ section.id }}" class="an-section an-theme">
  <div class="povf-wrap">
    <div class="an-container">
      <header class="povf-head an-reveal">
        {% if section.settings.eyebrow != blank %}
          <p class="povf-eyebrow">{{ section.settings.eyebrow }}</p>
        {% endif %}
        {% if section.settings.heading != blank %}
          <h2 class="povf-title">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="povf-sub">{{ section.settings.subheading }}</p>
        {% endif %}
      </header>

      <!-- Feature pills -->
      <div class="povf-features an-reveal">
        {% assign f1_text = section.settings.feature1_text | default: '' %}
        {% assign f1_img  = section.settings.feature1_image | default: '' %}

        {% assign f2_text = section.settings.feature2_text | default: '' %}
        {% assign f2_img  = section.settings.feature2_image | default: '' %}

        {% assign f3_text = section.settings.feature3_text | default: '' %}
        {% assign f3_img  = section.settings.feature3_image | default: '' %}

        <div class="povf-pill" data-img-pos="{{ section.settings.feature1_image_position | default: 'left' }}">
          <div class="povf-pill-icon">
            {% if f1_img != blank %}
              <img src="{{ section.settings.feature1_image | image_picker_url: '96x96' }}" alt="" loading="lazy" />
            {% else %}
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3l2.5 5 5 2.5-5 2.5L12 18l-2.5-5-5-2.5 5-2.5L12 3z" fill="currentColor" opacity=".25"/><path d="M8.5 12.5l2.2 2.2 4.8-4.8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            {% endif %}
          </div>
          <span>{{ f1_text }}</span>
        </div>
        <div class="povf-pill" data-img-pos="{{ section.settings.feature2_image_position | default: 'left' }}">
          <div class="povf-pill-icon">
            {% if f2_img != blank %}
              <img src="{{ section.settings.feature2_image | image_picker_url: '96x96' }}" alt="" loading="lazy" />
            {% else %}
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M8.5 12.5l2.2 2.2 4.8-4.8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            {% endif %}
          </div>
          <span>{{ f2_text }}</span>
        </div>
        <div class="povf-pill" data-img-pos="{{ section.settings.feature3_image_position | default: 'left' }}">
          <div class="povf-pill-icon">
            {% if f3_img != blank %}
              <img src="{{ section.settings.feature3_image | image_picker_url: '96x96' }}" alt="" loading="lazy" />
            {% else %}
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 12h16" stroke="currentColor" stroke-width="2"/><path d="M12 4v16" stroke="currentColor" stroke-width="2"/></svg>
            {% endif %}
          </div>
          <span>{{ f3_text }}</span>
        </div>
      </div>

      <!-- Modules grid -->
      <div class="povf-modules an-reveal" role="list">
        {% if section.blocks.size > 0 %}
          {% for block in section.blocks %}
            {% if block.type == 'module' %}
            <article class="povf-card" role="listitem" aria-label="{{ block.settings.title }}" {{ block.shopify_attributes }}>
              <div class="povf-card-header">
                <span class="povf-step">{{ forloop.index }}</span>
                <div class="povf-card-title">{{ block.settings.title }}</div>
              </div>
              {% if block.settings.desc != blank %}<p class="povf-card-desc">{{ block.settings.desc }}</p>{% endif %}
            </article>
            {% endif %}
          {% endfor %}
        {% else %}
          {% assign modules_raw = section.settings.modules | strip | split: '\n' %}
          {% for item in modules_raw %}
            {% assign m = item | strip %}
            {% if m != blank %}
              {% assign parts = m | split: '|' %}
              {% assign mtitle = parts[0] | strip %}
              {% assign mdesc = parts[1] | default: '' | strip %}
              <article class="povf-card" role="listitem" aria-label="{{ mtitle }}">
                <div class="povf-card-header">
                  <span class="povf-step">{{ forloop.index }}</span>
                  <div class="povf-card-title">{{ mtitle }}</div>
                </div>
                {% if mdesc != blank %}<p class="povf-card-desc">{{ mdesc }}</p>{% endif %}
              </article>
            {% endif %}
          {% endfor %}
        {% endif %}
      </div>

      <!-- CTAs -->
      <div class="povf-ctas an-reveal">
        {% if section.settings.cta_primary_text != blank and section.settings.cta_primary_url != blank %}
          <a href="{{ section.settings.cta_primary_url }}" class="an-btn-primary" data-evt="povf_cta" data-label="primary">{{ section.settings.cta_primary_text }}</a>
        {% endif %}
        {% if section.settings.cta_secondary_text != blank and section.settings.cta_secondary_url != blank %}
          <a href="{{ section.settings.cta_secondary_url }}" class="an-btn-secondary" data-evt="povf_cta" data-label="secondary">{{ section.settings.cta_secondary_text }}</a>
        {% endif %}
      </div>
    </div>
  </div>

  <style>
    /* Background shell */
    #pov-flagship-{{ section.id }} .povf-wrap{
      background:linear-gradient(180deg, rgba(126,106,255,.08), rgba(126,106,255,.04));
      border-radius:24px; margin:12px; overflow:hidden;
    }
    #pov-flagship-{{ section.id }} .an-container{max-width:1100px; margin:0 auto; padding:36px 18px 28px}

    /* Header */
    #pov-flagship-{{ section.id }} .povf-eyebrow{letter-spacing:.08em; font-size:.8rem; color:var(--c-ink-500)}
    #pov-flagship-{{ section.id }} .povf-title{font-size:1.9rem; color:var(--c-ink-900); margin:.15rem 0 .5rem; font-weight:700}
    #pov-flagship-{{ section.id }} .povf-sub{color:var(--c-ink-700); max-width:820px}

    /* Feature pills */
    #pov-flagship-{{ section.id }} .povf-features{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:14px; margin:18px 0 10px}
    @media (max-width: 900px){#pov-flagship-{{ section.id }} .povf-features{grid-template-columns:1fr}}
    #pov-flagship-{{ section.id }} .povf-pill{display:flex; align-items:center; gap:10px; background:rgba(255,255,255,.75); border:1px solid rgba(126,106,255,.25); border-radius:16px; padding:14px 16px; box-shadow:0 6px 16px rgba(0,0,0,.04)}
    #pov-flagship-{{ section.id }} .povf-pill-icon{width:28px; height:28px; border-radius:8px; background:linear-gradient(145deg, rgba(94,59,255,.15), rgba(24,213,228,.15)); color:var(--c-brand-600); display:grid; place-items:center; overflow:hidden}
    #pov-flagship-{{ section.id }} .povf-pill-icon img{display:block; width:100%; height:100%; object-fit:cover}
    /* per-pill image placement control */
    #pov-flagship-{{ section.id }} .povf-pill[data-img-pos="left"]{flex-direction:row}
    #pov-flagship-{{ section.id }} .povf-pill[data-img-pos="right"]{flex-direction:row-reverse}
    #pov-flagship-{{ section.id }} .povf-pill[data-img-pos="top"]{flex-direction:column}
    #pov-flagship-{{ section.id }} .povf-pill[data-img-pos="bottom"]{flex-direction:column-reverse}

    /* Modules */
    #pov-flagship-{{ section.id }} .povf-modules{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px; margin:16px 0 6px}
    @media (max-width: 900px){#pov-flagship-{{ section.id }} .povf-modules{grid-template-columns:1fr}}
    #pov-flagship-{{ section.id }} .povf-card{background:rgba(255,255,255,.78); border:1px solid rgba(126,106,255,.22); border-radius:14px; padding:14px 16px; box-shadow:0 6px 16px rgba(0,0,0,.05)}
    #pov-flagship-{{ section.id }} .povf-card-header{display:flex; align-items:center; gap:10px}
    #pov-flagship-{{ section.id }} .povf-step{width:28px; height:28px; border-radius:9999px; display:grid; place-items:center; font-weight:700; color:#fff; background:linear-gradient(135deg, #6757FF 0%, #7B4DFF 100%); box-shadow:0 0 10px rgba(105,78,255,.25)}
    #pov-flagship-{{ section.id }} .povf-card-title{font-weight:600; color:var(--c-ink-900)}
    #pov-flagship-{{ section.id }} .povf-card-desc{color:var(--c-ink-500); margin:.25rem 0 0}

    /* CTAs */
    #pov-flagship-{{ section.id }} .povf-ctas{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
    #pov-flagship-{{ section.id }} .an-btn-primary{background:var(--g-brand, linear-gradient(135deg, #6757FF 0%, #7B4DFF 100%)); color:#fff; border-radius:9999px; padding:12px 22px; font-weight:600; text-decoration:none; box-shadow:0 6px 16px rgba(94,59,255,.35)}
    #pov-flagship-{{ section.id }} .an-btn-secondary{background:#fff; color:var(--c-brand-600); border:1px solid var(--c-brand-100); border-radius:12px; padding:10px 18px; text-decoration:none}
  </style>

  <script>
    (function(){
      document.documentElement.classList.add('an-js');
      var root = document.getElementById('pov-flagship-{{ section.id }}');
      if(!root || root.dataset.inited==='1') return; root.dataset.inited='1';
      var items = [].slice.call(root.querySelectorAll('.an-reveal'));
      function showAll(){ items.forEach(function(n){ n.classList.add('is-in'); }); }
      var inEditor =
        location.search.indexOf('preview')>-1 ||
        !!document.querySelector('[data-kajabi-theme-editor],[data-builder],[data-editor]') ||
        (function(){ try { return window.top !== window.self; } catch(e){ return true; } })();
      if('IntersectionObserver' in window && !inEditor){
        var io = new IntersectionObserver(function(entries){
          entries.forEach(function(e){ if(e.isIntersecting){ e.target.classList.add('is-in'); io.unobserve(e.target); }});
        }, {threshold:.15});
        items.forEach(function(n){ io.observe(n); });
        setTimeout(function(){ items.forEach(function(n){ n.classList.add('is-in'); }); }, 1600);
      } else { showAll(); }
    })();
  </script>
</section>

{% schema %}
{
  "name": "Program Overview â€” Flagship",
  "elements": [
    { "type": "header", "content": "Header" },
    { "type": "text", "id": "eyebrow", "label": "Eyebrow", "default": "Flagship" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "The Secure Parenting Program" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "A 6â€‘week, therapistâ€‘led pathâ€”Payâ€‘Whatâ€‘Youâ€‘Can. Every tier includes everything." },

    { "type": "header", "content": "Top Features" },
    { "type": "image_picker", "id": "feature1_image", "label": "Feature 1 Image" },
    { "type": "select", "id": "feature1_image_position", "label": "Feature 1 image position", "default": "left", "options": [
      {"label":"Left","value":"left"}, {"label":"Right","value":"right"}, {"label":"Top","value":"top"}, {"label":"Bottom","value":"bottom"}
    ] },
    { "type": "text", "id": "feature1_text", "label": "Feature 1 Text", "default": "Lifetime access (all updates included)" },
    { "type": "image_picker", "id": "feature2_image", "label": "Feature 2 Image" },
    { "type": "select", "id": "feature2_image_position", "label": "Feature 2 image position", "default": "left", "options": [
      {"label":"Left","value":"left"}, {"label":"Right","value":"right"}, {"label":"Top","value":"top"}, {"label":"Bottom","value":"bottom"}
    ] },
    { "type": "text", "id": "feature2_text", "label": "Feature 2 Text", "default": "Monthly live Q&A with Eli (recorded + searchable)" },
    { "type": "image_picker", "id": "feature3_image", "label": "Feature 3 Image" },
    { "type": "select", "id": "feature3_image_position", "label": "Feature 3 image position", "default": "left", "options": [
      {"label":"Left","value":"left"}, {"label":"Right","value":"right"}, {"label":"Top","value":"top"}, {"label":"Bottom","value":"bottom"}
    ] },
    { "type": "text", "id": "feature3_text", "label": "Feature 3 Text", "default": "Printable scripts & worksheets" },

    { "type": "header", "content": "Modules" },
    { "type": "textarea", "id": "modules", "label": "Modules (fallback text list)", "default": "Week 1 â€” Attachment Code | Spot your pattern â†’ Worksheet\nWeek 2 â€” Trust & Connection | Mirror emotions â†’ Delight diary\nWeek 3 â€” C.A.L.M. Under Fire | Run the protocol â†’ Pocket scripts\nWeek 4 â€” Secure Base | Kindâ€‘andâ€‘firm limits â†’ Boundaries menu\nWeek 5 â€” Connected Protection | Safety without panic â†’ Scripts\nWeek 6 â€” Rupture â†’ Repair | Repair that sticks â†’ Ritual card" },

    { "type": "header", "content": "CTAs" },
    { "type": "text", "id": "cta_primary_text", "label": "Primary CTA Text", "default": "Start Tonight â€” Choose Your Price â†’" },
    { "type": "action", "id": "cta_primary_url", "label": "Primary CTA Link", "default": "#pricing-pwyc-slider" },
    { "type": "text", "id": "cta_secondary_text", "label": "Secondary CTA Text", "default": "Watch a 5â€‘minute sample â†’" },
    { "type": "action", "id": "cta_secondary_url", "label": "Secondary CTA Link", "default": "#" }
  ],
  "presets": [
    { "name": "Program Overview â€” Flagship", "category": "Program", "blocks": [
      {"type":"module", "settings": {"title":"Week 1 â€” Attachment Code", "desc":"Spot your pattern â†’ Worksheet"}},
      {"type":"module", "settings": {"title":"Week 2 â€” Trust & Connection", "desc":"Mirror emotions â†’ Delight diary"}},
      {"type":"module", "settings": {"title":"Week 3 â€” C.A.L.M. Under Fire", "desc":"Run the protocol â†’ Pocket scripts"}},
      {"type":"module", "settings": {"title":"Week 4 â€” Secure Base", "desc":"Kindâ€‘andâ€‘firm limits â†’ Boundaries menu"}},
      {"type":"module", "settings": {"title":"Week 5 â€” Connected Protection", "desc":"Safety without panic â†’ Scripts"}},
      {"type":"module", "settings": {"title":"Week 6 â€” Rupture â†’ Repair", "desc":"Repair that sticks â†’ Ritual card"}}
    ] }
  ],
  "blocks": [
    {"type":"module", "name":"Module", "elements": [
      {"type":"text", "id":"title", "label":"Title", "default":"Week â€” Title"},
      {"type":"textarea", "id":"desc", "label":"One-liner", "default":"What youâ€™ll accomplish"}
    ]}
  ]
}
{% endschema %}
