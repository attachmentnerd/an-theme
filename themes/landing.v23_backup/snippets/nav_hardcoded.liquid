{% comment %}
Hardcoded Navigation Snippet
- No blocks or section schema
- Uses theme settings for logo URLs and invert toggle
- Hardcoded links, CTA, and login/library
{% endcomment %}

{% assign logo_normal = settings.nav_logo_url | default: 'https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production/file-uploads/themes/2162370086/settings_images/708217-6dc8-6e80-0466-7b518dfb74c7_6a4860b8-00bb-47fd-8078-c7f4dd4e5385.png' %}
{% assign logo_inverted = settings.nav_logo_url_inverted | default: 'https://kajabi-storefronts-production.kajabi-cdn.com/kajabi-storefronts-production//sites/2148666703/images/1d1d2ffe-9376-4248-b082-df05323d5e0b.webp' %}
{% assign use_inverted = settings.nav_use_inverted_logo %}
{% if use_inverted %}
  {% assign logo_current = logo_inverted %}
{% else %}
  {% assign logo_current = logo_normal %}
{% endif %}

{% assign nav_links_string = 'About=>/about|Books=>/books|Podcast=>/podcast|Speaking=>/speaking|Program=>/program/secure-parenting' %}
{% assign nav_links = nav_links_string | split: '|' %}
{% assign cta_label = settings.nav_cta_label | default: 'Get Started' %}
{% assign cta_url = settings.nav_cta_url | default: '/program/secure-parenting' %}
{% assign login_url = '/login' %}
{% assign profile_label = 'Login' %}
{% assign profile_event = 'nav_login' %}
{% if current_site_user %}
  {% assign login_url = '/library' %}
  {% assign profile_label = current_site_user.name | default: current_site_user.email | default: 'My Library' %}
  {% assign profile_event = 'nav_library' %}
{% endif %}

{% assign nav_style = settings.nav_style | default: 'solid' %}
{% assign nav_is_sticky = settings.nav_is_sticky %}
{% if nav_is_sticky == blank %}{% assign nav_is_sticky = true %}{% endif %}
{% assign nav_show_login = settings.nav_show_login %}
{% if nav_show_login == blank %}{% assign nav_show_login = true %}{% endif %}
{% assign current_path = request.path | default: '/' %}
{% assign current_path = current_path | downcase | replace: '//','/' %}
{% assign global_nav_enabled = settings.show_navigation %}
{% if global_nav_enabled == blank %}{% assign global_nav_enabled = true %}{% endif %}
{% assign secondary_label = settings.nav_secondary_label | default: 'Free Downloads' %}
{% assign secondary_url = settings.nav_secondary_url | default: '/downloads' %}

<style>
  .hc-nav {
    {% if nav_is_sticky %}position: sticky; top: 0;{% else %}position: relative;{% endif %}
    z-index: 9999;
    padding: 0.9rem 0;
    {% if nav_style == 'transparent' %}
      background: transparent;
      border-bottom: none;
      backdrop-filter: none;
    {% else %}
      background: #ffffffcc;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(15,23,42,0.08);
    {% endif %}
  }
  .hc-nav__container{display:flex;align-items:center;gap:1rem;justify-content:space-between}
  .hc-nav__logo{display:inline-flex;align-items:center;text-decoration:none}
  .hc-nav__logo img{height:32px;width:auto;display:block}
  .hc-nav__links{display:flex;align-items:center;gap:0.5rem}
  .hc-nav__link{display:inline-flex;min-width:60px;padding:0.45rem 0.9rem;border-radius:999px;color:#374151;text-decoration:none;font-weight:500;transition:color .2s ease, background .2s ease}
  .hc-nav__link:hover{color:#5e3bff;background:rgba(94,59,255,0.08)}
  .hc-nav__link.is-active{color:#5e3bff;font-weight:600;background:rgba(94,59,255,0.12)}
  .hc-nav__link:focus-visible,.hc-nav__cta:focus-visible,.hc-nav__avatar:focus-visible{outline:none;box-shadow:0 0 0 3px rgba(94,59,255,0.4)}
  .hc-nav__actions{display:flex;align-items:center;gap:0.75rem;margin-left:auto}
  .hc-nav__avatar{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;border:2px solid rgba(94,59,255,0.2);background:#fff;text-decoration:none;color:#1f2937;font-weight:600}
  .hc-nav__cta{display:inline-flex;align-items:center;justify-content:center;padding:0.6rem 1.2rem;border-radius:999px;background:linear-gradient(135deg,#5e3bff 0%,#7b66ff 100%);color:#fff;text-decoration:none;font-weight:600}
  .hc-nav__toggle{display:none;flex-direction:column;gap:3px;width:44px;height:44px;border-radius:50%;border:1px solid rgba(148,163,184,0.45);background:#fff;position:relative;z-index:10002;box-shadow:0 2px 10px rgba(15,23,42,0.08)}
  .hc-nav__toggle span{display:block;width:18px;height:2px;background:#1f2937;border-radius:999px;margin:0 auto}
  .hc-nav__drawer{display:none}
  .hc-nav__backdrop{display:none}
  .hc-nav.is-open .hc-nav__backdrop{display:block;position:fixed;inset:0;background:rgba(15,23,42,0.5);backdrop-filter:blur(3px);z-index:994}
  .hc-nav.is-open .hc-nav__drawer{display:flex;position:fixed;inset:0;z-index:995;flex-direction:column;justify-content:center;align-items:center;gap:1.2rem;background:#ffffff}
  .hc-nav.is-scrolled{box-shadow:0 8px 24px -16px rgba(15,23,42,0.15)}
  .hc-nav.is-open .hc-nav__drawer a{color:#1f2937;text-decoration:none;font-size:1.2rem}
  @media(max-width:1024px){
    .hc-nav{padding:0.7rem 0}
    .hc-nav__links{display:none}
    .hc-nav__actions{display:none}
    .hc-nav__toggle{display:flex}
  }
  @media (prefers-reduced-motion: reduce){
    .hc-nav__link,.hc-nav__cta{transition:none}
  }
</style>

{% if global_nav_enabled %}
<nav class="hc-nav" role="navigation" aria-label="Main">
  <div class="container hc-nav__container">
    <a class="hc-nav__logo" href="{{ current_site.root_url | default: '/' }}">
      <img src="{{ logo_current }}" alt="Logo">
    </a>

    <div class="hc-nav__links" aria-label="Primary navigation">
      {% for item in nav_links %}
        {% assign parts = item | split: '=>' %}
        {% assign label = parts[0] | strip %}
        {% assign url = parts[1] | strip | default: '/' %}
        {% assign normalized_url = url | downcase %}
        {% assign is_active = false %}
        {% if current_path == normalized_url or current_path == normalized_url | append: '/' %}
          {% assign is_active = true %}
        {% endif %}
        <a class="hc-nav__link{% if is_active %} is-active{% endif %}" href="{{ url }}"{% if is_active %} aria-current="page"{% endif %} data-evt="nav_link_{{ label | handle }}">{{ label }}</a>
      {% endfor %}
    </div>

    <div class="hc-nav__actions">
      {% if nav_show_login %}
        {% if current_site_user %}
          <a class="hc-nav__avatar" href="/library" data-evt="{{ profile_event }}">
            {% assign avatar_url = current_site_user | avatar_url %}
            {% if avatar_url %}
              <img src="{{ avatar_url }}" alt="{{ current_site_user.name | default: 'Account' }}" style="width:100%;height:100%;object-fit:cover;display:block"/>
            {% else %}
              {{ profile_label | slice: 0, 1 | upcase }}
            {% endif %}
          </a>
        {% else %}
          <a class="hc-nav__avatar" href="{{ login_url }}" data-evt="{{ profile_event }}" aria-label="Login">L</a>
        {% endif %}
      {% endif %}
      <a class="hc-nav__cta" href="{{ cta_url }}" data-evt="nav_cta">{{ cta_label }}</a>
      <a class="hc-nav__cta" href="{{ secondary_url }}" data-evt="nav_cta_secondary" style="background:#ffffff;color:#5e3bff;border:1px solid rgba(94,59,255,0.35);box-shadow:none">{{ secondary_label }}</a>
    </div>

    <button class="hc-nav__toggle" type="button" aria-label="Toggle navigation" aria-expanded="false" data-hc-toggle>
      <span></span><span></span><span></span>
    </button>
  </div>

  <div class="hc-nav__backdrop" data-hc-backdrop></div>
  <div class="hc-nav__drawer" role="dialog" aria-modal="true" aria-label="Mobile navigation" data-hc-drawer>
    {% for item in nav_links %}
      {% assign parts = item | split: '=>' %}
      {% assign label = parts[0] | strip %}
      {% assign url = parts[1] | strip | default: '/' %}
      <a href="{{ url }}" data-evt="nav_link_mobile_{{ label | handle }}">{{ label }}</a>
    {% endfor %}
    <a class="hc-nav__cta" href="{{ cta_url }}" data-evt="nav_cta_mobile">{{ cta_label }}</a>
    <a class="hc-nav__cta" href="{{ secondary_url }}" data-evt="nav_cta_secondary_mobile" style="background:#ffffff;color:#5e3bff;border:1px solid rgba(94,59,255,0.35);box-shadow:none">{{ secondary_label }}</a>
    {% if nav_show_login %}
      <a class="hc-nav__avatar" href="{{ login_url }}" data-evt="{{ profile_event }}">{{ profile_label }}</a>
    {% endif %}
  </div>
</nav>

<script>
  (function(){
    var nav=document.querySelector('.hc-nav');
    if(!nav) return;
    var t=nav.querySelector('[data-hc-toggle]');
    var d=nav.querySelector('[data-hc-drawer]');
    var b=nav.querySelector('[data-hc-backdrop]');
    if(!t||!d) return;
    function close(){nav.classList.remove('is-open');t.setAttribute('aria-expanded','false');}
    t.addEventListener('click',function(){var o=nav.classList.toggle('is-open');t.setAttribute('aria-expanded',o?'true':'false');});
    d.querySelectorAll('a').forEach(function(a){a.addEventListener('click',close)});
    document.addEventListener('keyup',function(e){if(e.key==='Escape') close();});
    if(b){b.addEventListener('click',close)}

    // Elevate nav on scroll (adds shadow), improves contrast for transparent style
    var ticking=false;
    function onScroll(){
      if(ticking) return; ticking=true;
      window.requestAnimationFrame(function(){
        var scrolled=window.scrollY>2; // small threshold
        if(scrolled){nav.classList.add('is-scrolled')} else {nav.classList.remove('is-scrolled')}
        ticking=false;
      });
    }
    window.addEventListener('scroll',onScroll,{passive:true});
    onScroll();
  })();
</script>
{% endif %}

