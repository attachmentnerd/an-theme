{% comment %}
Footer Controller Snippet
Provides centralized footer rendering with global theme controls plus
optional overrides for specific layouts or templates.

Priority order:
1. Page-level setting (page.hide_global_footer or page.show_global_footer)
2. `force_hide` parameter (always hides)
3. `force_show` parameter (always shows)
4. Global theme toggle (`settings.show_footer`)
5. Path-based suppression via `settings.footer_hide_paths`

Usage Examples:
{% include 'footer_controller' %}
{% include 'footer_controller', force_hide: true %}
{% include 'footer_controller', footer_section: 'nav_footer_bio' %}
{% endcomment %}

{% assign should_show_footer = false %}

{% comment %} Check for page-level footer setting first - Try multiple Kajabi properties {% endcomment %}
{% comment %} Debug info available in HTML comments when needed {% endcomment %}

{% comment %} Check various possible page properties {% endcomment %}
{% if page.hide_global_footer == true %}
  {% assign should_show_footer = false %}
  {% assign page_override = true %}
  {% assign override_reason = 'page.hide_global_footer is true' %}
{% elsif page.show_global_footer == false %}
  {% assign should_show_footer = false %}
  {% assign page_override = true %}
  {% assign override_reason = 'page.show_global_footer is false' %}
{% elsif page.settings.hide_footer == true %}
  {% assign should_show_footer = false %}
  {% assign page_override = true %}
  {% assign override_reason = 'page.settings.hide_footer is true' %}
{% elsif page.settings.show_footer == false %}
  {% assign should_show_footer = false %}
  {% assign page_override = true %}
  {% assign override_reason = 'page.settings.show_footer is false' %}
{% elsif current_page.hide_global_footer == true %}
  {% assign should_show_footer = false %}
  {% assign page_override = true %}
  {% assign override_reason = 'current_page.hide_global_footer is true' %}
{% elsif current_page.show_global_footer == false %}
  {% assign should_show_footer = false %}
  {% assign page_override = true %}
  {% assign override_reason = 'current_page.show_global_footer is false' %}
{% endif %}

{% comment %} Always use the hardcoded modern footer {% endcomment %}
{% assign resolved_footer_section = 'nav_footer_modern' %}

{% comment %} Normalize global toggle so legacy installs default to true {% endcomment %}
{% assign global_footer_enabled = settings.show_footer %}
{% if global_footer_enabled == blank %}
  {% assign global_footer_enabled = true %}
{% elsif global_footer_enabled == true or global_footer_enabled == 'true' or global_footer_enabled == '1' %}
  {% assign global_footer_enabled = true %}
{% else %}
  {% comment %} Treat all other values (false, 'false', '0', 0, etc.) as false {% endcomment %}
  {% assign global_footer_enabled = false %}
{% endif %}

{% comment %} Visibility precedence - only apply if no page override {% endcomment %}
{% unless page_override %}
  {% if force_hide %}
    {% assign should_show_footer = false %}
  {% elsif force_show %}
    {% assign should_show_footer = true %}
  {% elsif global_footer_enabled %}
    {% assign should_show_footer = true %}
  {% endif %}
{% endunless %}

{% comment %}
  Apply path-based suppression unless force_show or page override is active.
  Supports newline-delimited entries with optional wildcard * suffix.
{% endcomment %}
{% assign hide_footer_for_path = false %}
{% if force_show != true and page_override != true and should_show_footer %}
  {% assign current_path = request.path | default: '/' %}
  {% assign current_path = current_path | downcase | strip %}
  {% assign current_path = current_path | replace: '//', '/' %}
  {% assign current_length = current_path | size %}
  {% if current_length == 0 %}
    {% assign current_path = '/' %}
    {% assign current_length = 1 %}
  {% endif %}
  {% if current_path != '/' %}
    {% assign current_last_index = current_length | minus: 1 %}
    {% assign current_last_char = current_path | slice: current_last_index, 1 %}
    {% if current_last_char == '/' %}
      {% assign trimmed_length = current_length | minus: 1 %}
      {% assign current_path = current_path | slice: 0, trimmed_length %}
      {% assign current_length = current_path | size %}
      {% if current_length == 0 %}
        {% assign current_path = '/' %}
        {% assign current_length = 1 %}
      {% endif %}
    {% endif %}
  {% endif %}

  {% assign raw_hide_paths = settings.footer_hide_paths | default: '' %}
  {% if raw_hide_paths != '' %}
    {% assign normalized_hide_paths = raw_hide_paths | replace: '\r\n', '\n' | replace: '\r', '\n' %}
    {% assign hide_path_entries = normalized_hide_paths | split: '\n' %}
    {% for raw_entry in hide_path_entries %}
      {% assign entry = raw_entry | strip %}
      {% if entry != '' %}
        {% assign entry = entry | downcase | replace: '//', '/' %}
        {% assign is_wildcard = false %}
        {% assign entry_length = entry | size %}
        {% if entry_length > 0 %}
          {% assign entry_last_index = entry_length | minus: 1 %}
          {% assign entry_last_char = entry | slice: entry_last_index, 1 %}
          {% if entry_last_char == '*' %}
            {% assign is_wildcard = true %}
            {% assign trimmed_length = entry_length | minus: 1 %}
            {% assign entry = entry | slice: 0, trimmed_length %}
          {% endif %}
        {% endif %}
        {% assign entry_length = entry | size %}
        {% if entry_length > 0 %}
          {% assign entry_first_char = entry | slice: 0, 1 %}
          {% if entry_first_char != '/' %}
            {% assign entry = '/' | append: entry %}
          {% endif %}
        {% endif %}
        {% assign entry_length = entry | size %}
        {% if entry != '/' and entry_length > 1 %}
          {% assign entry_last_index = entry_length | minus: 1 %}
          {% assign entry_last_char = entry | slice: entry_last_index, 1 %}
          {% if entry_last_char == '/' %}
            {% assign trimmed_length = entry_length | minus: 1 %}
            {% assign entry = entry | slice: 0, trimmed_length %}
            {% assign entry_length = entry | size %}
          {% endif %}
        {% endif %}

        {% if entry_length == 0 %}
          {% assign hide_footer_for_path = true %}
        {% elsif is_wildcard %}
          {% if current_path == entry %}
            {% assign hide_footer_for_path = true %}
          {% elsif entry_length > 0 %}
            {% assign candidate = current_path | slice: 0, entry_length %}
            {% if candidate == entry %}
              {% assign hide_footer_for_path = true %}
            {% endif %}
          {% endif %}
        {% elsif current_path == entry %}
          {% assign hide_footer_for_path = true %}
        {% endif %}
      {% endif %}
      {% if hide_footer_for_path %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endif %}

{% if hide_footer_for_path %}
  {% assign should_show_footer = false %}
{% endif %}

{% comment %} Add CSS override if footer should be hidden {% endcomment %}
{% unless should_show_footer %}
  <style>
    /* Force hide footer when page settings disable it */
    footer,
    .footer,
    .site-footer,
    .nav-footer,
    .nav-footer-modern,
    [class*="footer"],
    [id*="footer"] {
      display: none !important;
      visibility: hidden !important;
    }
  </style>
{% endunless %}

{% comment %} Debug output {% endcomment %}
{% if override_reason %}
  <!-- Footer hidden: {{ override_reason }} -->
{% endif %}

{% comment %} Render hardcoded footer if visible {% endcomment %}
{% if should_show_footer %}
  {% section 'nav_footer_modern' %}
{% endif %}
