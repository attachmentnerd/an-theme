{% comment %}
  Accordion Section (Shared)

  Supports text toggle blocks and a special "Slim Card" block that reuses the
  slim horizontal card layout inside an accordion item.
{% endcomment %}

{% assign s-id = section.id %}
{% assign acc_id = 'acc-' | append: s-id %}
{% assign acc_bg = section.settings.bg | default: 'transparent' %}

<style>
  .accordion--{{ s-id }} { background: {{ acc_bg }}; }
  .accordion__item { border-bottom: 1px solid var(--border-light); }
  .accordion__header { display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) 0; cursor: pointer; }
  .accordion__title { margin: 0; font-size: var(--fs-h5); color: var(--c-ink-900); }
  .accordion__chevron { transition: transform var(--duration-fast) var(--motion-ease-standard); }
  .accordion__content { display: none; padding: 0 0 var(--space-md) 0; }
  .accordion__item[aria-expanded="true"] .accordion__content { display: block; }
  .accordion__item[aria-expanded="true"] .accordion__chevron { transform: rotate(180deg); }
  .accordion__body { color: var(--c-ink-700); font-size: var(--fs-body); }
  .accordion__body :last-child { margin-bottom: 0; }
</style>

<div class="container">
  <div class="accordion accordion--{{ s-id }}" id="{{ acc_id }}">
    {% for block in section.blocks %}
      {% assign expanded = block.settings.open_by_default %}
      <div class="accordion__item" id="block-{{ block.id }}" aria-expanded="{% if expanded %}true{% else %}false{% endif %}" {% block_attributes %}>
        <div class="accordion__header" data-acc-trigger>
          <h4 class="accordion__title" kjb-settings-id="{{ 'title' | settings_id: section: section, block: block }}">{{ block.settings.title }}</h4>
          {% include "icon", icon: 'chevron-down', size: 18, class: 'accordion__chevron', color: 'currentColor', aria_label: '' %}
        </div>
        <div class="accordion__content" data-acc-content>
          {% case block.type %}
            {% when 'toggle' %}
              <div class="accordion__body" kjb-settings-id="{{ 'content' | settings_id: section: section, block: block }}">{{ block.settings.content }}</div>
            {% when 'slim_card' %}
              {% assign tmp = block %}
              <div class="accordion__body">
                <div class="slim-card slim-card--{{ block.id }}" style="--bg: {{ block.settings.bg | default: 'var(--c-white)' }}; --accent: {{ block.settings.accent | default: 'var(--c-brand-600)' }};">
                  <div class="slim-card__inner">
                    <div class="slim-card__media">
                      {% if block.settings.image %}
                        <img src="{{ block.settings.image }}" alt="{{ block.settings.title }}" class="slim-card__img" />
                      {% else %}
                        <img src="{{ 'placeholder.png' | asset_url }}" alt="{{ block.settings.title }}" class="slim-card__img" />
                      {% endif %}
                    </div>
                    <div class="slim-card__body">
                      {% if block.settings.kicker %}
                        <div class="kicker" style="color:var(--c-ink-500); margin-bottom: 4px; font-size: var(--fs-caption);">{{ block.settings.kicker }}</div>
                      {% endif %}
                      <h3 class="slim-card__title">{{ block.settings.title }}</h3>
                      {% if block.settings.description %}
                        <p class="slim-card__desc">{{ block.settings.description }}</p>
                      {% endif %}
                    </div>
                    <div class="slim-card__ctas">
                      {% if block.settings.cta1_text and block.settings.cta1_url %}
                        <a href="{{ block.settings.cta1_url }}" class="slim-card__btn" {% if block.settings.cta1_new %}target="_blank" rel="noopener noreferrer"{% endif %}>{{ block.settings.cta1_text }}</a>
                      {% endif %}
                      {% if block.settings.cta2_text and block.settings.cta2_url %}
                        <a href="{{ block.settings.cta2_url }}" class="slim-card__btn slim-card__btn--outline" {% if block.settings.cta2_new %}target="_blank" rel="noopener noreferrer"{% endif %}>{{ block.settings.cta2_text }}</a>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
          {% endcase %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  (function(){
    var root = document.getElementById('{{ acc_id }}');
    if(!root) return;
    root.addEventListener('click', function(e){
      var header = e.target.closest('[data-acc-trigger]');
      if(!header) return;
      var item = header.parentElement;
      var expanded = item.getAttribute('aria-expanded') === 'true';
      item.setAttribute('aria-expanded', expanded ? 'false' : 'true');
    });
  })();
  </script>

{% schema %}
{
  "name": "Accordion",
  "elements": [
    { "type": "color", "id": "bg", "label": "Background", "default": "transparent" }
  ],
  "blocks": [
    {
      "type": "toggle",
      "name": "Toggle Item",
      "elements": [
        { "type": "text", "id": "title", "label": "Title", "default": "Accordion title" },
        { "type": "textarea", "id": "content", "label": "Content", "default": "Accordion content goes here." },
        { "type": "checkbox", "id": "open_by_default", "label": "Open by default", "default": false }
      ]
    },
    {
      "type": "slim_card",
      "name": "Slim Card Item",
      "elements": [
        { "type": "text", "id": "kicker", "label": "Kicker", "default": "Introducing" },
        { "type": "text", "id": "title", "label": "Title", "default": "Slim Card Title" },
        { "type": "textarea", "id": "description", "label": "Description", "default": "Short supporting copy goes here." },
        { "type": "image", "id": "image", "label": "Image URL" },
        { "type": "color", "id": "bg", "label": "Card Background", "default": "var(--c-white)" },
        { "type": "color", "id": "accent", "label": "Accent", "default": "var(--c-brand-600)" },
        { "type": "text", "id": "cta1_text", "label": "CTA 1 Text", "default": "Learn more" },
        { "type": "url", "id": "cta1_url", "label": "CTA 1 URL", "default": "#" },
        { "type": "checkbox", "id": "cta1_new", "label": "CTA 1 open in new tab", "default": false },
        { "type": "text", "id": "cta2_text", "label": "CTA 2 Text" },
        { "type": "url", "id": "cta2_url", "label": "CTA 2 URL" },
        { "type": "checkbox", "id": "cta2_new", "label": "CTA 2 open in new tab", "default": false },
        { "type": "checkbox", "id": "open_by_default", "label": "Open by default", "default": false }
      ]
    }
  ],
  "presets": [
    { "name": "Accordion", "category": "Content", "blocks": [ {"type":"toggle"} ] }
  ]
}
{% endschema %}





