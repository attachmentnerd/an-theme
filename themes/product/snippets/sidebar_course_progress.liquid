{% comment %}
  Sidebar Course Progress Block
  Shows current product completion progress
{% endcomment %}

{% if current_product %}
  {% assign completion = current_product.completion %}
  {% assign progress_color = block.settings.progress_color | default: '#2AB3B1' %}
  {% assign bg_color = block.settings.background_color | default: '#f8f9fa' %}

  <div class="sidebar-block course-progress-block" style="background-color: {{ bg_color }};">
    {% if block.settings.heading %}
      <h3 class="sidebar-block__title">{{ block.settings.heading }}</h3>
    {% endif %}

    <div class="progress-container">
      <div class="progress">
        <div class="progress-bar"
             role="progressbar"
             style="width: {{ completion.percent }}%; background-color: {{ progress_color }};"
             aria-valuenow="{{ completion.percent }}"
             aria-valuemin="0"
             aria-valuemax="100"
             aria-label="Course progress">
        </div>
      </div>

      <div class="progress-details">
        {% if block.settings.show_percentage != false %}
          <div class="progress-percentage">{{ completion.percent }}% Complete</div>
        {% endif %}

        {% if block.settings.show_completed_count != false %}
          <div class="progress-count">{{ completion.completed }} of {{ completion.total }} lessons completed</div>
        {% endif %}
      </div>
    </div>
  </div>

  <style>
    .course-progress-block {
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
    }

    .course-progress-block .sidebar-block__title {
      margin: 0 0 15px 0;
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .course-progress-block .progress {
      height: 24px;
      background-color: rgba(0,0,0,0.1);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .course-progress-block .progress-bar {
      height: 100%;
      border-radius: 12px;
      transition: width 0.3s ease;
    }

    .course-progress-block .progress-details {
      font-size: 14px;
      color: #666;
    }

    .course-progress-block .progress-percentage {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }
  </style>
{% endif %}
