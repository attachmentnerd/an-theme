{% comment %}
  Circular Progress Indicator

  Usage:
    {% include 'progress_circular', percent: 75, size: 'medium', show_label: true %}

  Parameters:
    - percent: (required) 0-100
    - size: 'small' (60px), 'medium' (100px), 'large' (140px) - default: medium
    - show_label: true/false - show percentage text
    - color: Override brand color
    - label_text: Custom label below circle
{% endcomment %}

{% assign circle_percent = percent | default: 0 %}
{% assign circle_size = size | default: 'medium' %}
{% assign show_label = show_label | default: true %}
{% assign custom_color = color | default: '' %}
{% assign label = label_text | default: '' %}

{% comment %} Size configurations {% endcomment %}
{% if circle_size == 'small' %}
  {% assign circle_width = 60 %}
  {% assign stroke_width = 4 %}
  {% assign font_size = 14 %}
{% elsif circle_size == 'large' %}
  {% assign circle_width = 140 %}
  {% assign stroke_width = 8 %}
  {% assign font_size = 28 %}
{% else %}
  {% assign circle_width = 100 %}
  {% assign stroke_width = 6 %}
  {% assign font_size = 20 %}
{% endif %}

{% assign radius = circle_width | minus: stroke_width | divided_by: 2.0 %}
{% assign circumference = radius | times: 2 | times: 3.14159 %}
{% assign offset = circumference | times: circle_percent | divided_by: 100 | times: -1 | plus: circumference %}

<div class="an-progress-circular" data-percent="{{ circle_percent }}" style="width: {{ circle_width }}px; height: {{ circle_width }}px;">
  <svg class="an-progress-circular__svg" width="{{ circle_width }}" height="{{ circle_width }}" viewBox="0 0 {{ circle_width }} {{ circle_width }}">
    {% comment %} Background circle {% endcomment %}
    <circle
      class="an-progress-circular__bg"
      cx="{{ circle_width | divided_by: 2 }}"
      cy="{{ circle_width | divided_by: 2 }}"
      r="{{ radius }}"
      fill="none"
      stroke="var(--c-brand-100)"
      stroke-width="{{ stroke_width }}"
    />

    {% comment %} Progress circle {% endcomment %}
    <circle
      class="an-progress-circular__progress"
      cx="{{ circle_width | divided_by: 2 }}"
      cy="{{ circle_width | divided_by: 2 }}"
      r="{{ radius }}"
      fill="none"
      stroke="{% if custom_color != '' %}{{ custom_color }}{% else %}var(--c-brand-600){% endif %}"
      stroke-width="{{ stroke_width }}"
      stroke-linecap="round"
      stroke-dasharray="{{ circumference }}"
      stroke-dashoffset="{{ offset }}"
      transform="rotate(-90 {{ circle_width | divided_by: 2 }} {{ circle_width | divided_by: 2 }})"
      style="transition: stroke-dashoffset 0.6s ease-out;"
    />
  </svg>

  {% if show_label %}
    <div class="an-progress-circular__label" style="font-size: {{ font_size }}px;">
      <span class="an-progress-circular__percent">{{ circle_percent }}%</span>
    </div>
  {% endif %}

  {% if label != '' %}
    <div class="an-progress-circular__text">{{ label }}</div>
  {% endif %}
</div>

<style>
.an-progress-circular {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
}

.an-progress-circular__svg {
  transform: scaleY(-1);
}

.an-progress-circular__label {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: 600;
  color: var(--c-ink-900);
  text-align: center;
}

.an-progress-circular__percent {
  display: block;
  line-height: 1;
}

.an-progress-circular__text {
  position: absolute;
  bottom: -24px;
  left: 50%;
  transform: translateX(-50%);
  font-size: var(--an-font-sm);
  color: var(--c-ink-600);
  white-space: nowrap;
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .an-progress-circular {
    margin: var(--an-space-md) auto;
  }
}
</style>
