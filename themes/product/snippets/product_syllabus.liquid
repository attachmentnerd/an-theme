{% include "panel_style", bgColor: "#fff" %}

<style>
  .syllabus .syllabus__item { margin-bottom: {{ section.settings.gap_y | default: 12 }}px; }
  /* Chapter row styling */
  .syllabus.panel {
    {% if section.settings.card_style == 'outline' %}
      box-shadow: none;
      border: 1px solid rgba(0,0,0,.08);
      border-radius: {{ section.settings.card_radius | default: 12 }}px;
      background: #fff;
    {% elsif section.settings.card_style == 'flat' %}
      box-shadow: none;
      border: none;
      border-radius: {{ section.settings.card_radius | default: 12 }}px;
      background: {{ section.settings.card_bg | default: '#fff' }};
    {% else %}
      border: none;
      border-radius: {{ section.settings.card_radius | default: 12 }}px;
      {% if section.settings.card_shadow %}
        box-shadow: 0 8px 24px rgba(0,0,0,.08);
      {% else %}
        box-shadow: none;
      {% endif %}
      background: #fff;
    {% endif %}
    {% if section.settings.chapter_bg and section.settings.chapter_bg != '' %}
      background: {{ section.settings.chapter_bg }};
    {% endif %}
    {% if section.settings.chapter_radius %}
      border-radius: {{ section.settings.chapter_radius }}px;
    {% endif %}
    {% if section.settings.chapter_shadow %}
      box-shadow: 0 10px 28px rgba(0,0,0,.10);
    {% endif %}
  }

  /* Lesson row layout: image column as percentage */
  .syllabus .syllabus__item .media { display: grid; grid-template-columns: {{ section.settings.image_percent | default: 25 }}% 1fr auto; column-gap: 16px; align-items: center; }
  .syllabus .media-left { width: 100%; }
  .syllabus .syllabus__img { width: 100%; }
  .syllabus .thumb {
    width: 100%;
    height: auto;
    object-fit: {{ section.settings.image_fit | default: 'cover' }};
    {% if section.settings.image_shape == 'circle' %}
      border-radius: 999px;
      aspect-ratio: 1 / 1;
    {% elsif section.settings.image_shape == 'rounded' or section.settings.image_shape == blank %}
      border-radius: 8px;
      aspect-ratio: 16 / 9;
    {% else %}
      border-radius: 0;
      aspect-ratio: 16 / 9;
    {% endif %}
  }
  .syllabus.panel {
    padding: 8px;
  }
</style>

{% if section.settings.show_syllabus %}
  {% if section.settings.type == "posts" %}
    {% paginate product.categories by 10 %}
      {% for category in paginate.collection %}
        {% if category.pending_drip? %}
          <div class="panel syllabus" kjb-settings-id="{{ 'type' | settings_id: section: section }}">
            <div class="panel__body">
              <h5 class="syllabus__heading">
                {{ category.title }}
                {% if category.show_as_paywalled? %}
                  {% include "icon_paywall" %}
                {% endif %}
                <span kjb-settings-id="{{ 'coming_soon' | settings_id: section: section }}">&nbsp;{{ section.settings.coming_soon }}</span>
              </h5>
            </div>
          </div>
        {% else %}
          <div class="panel syllabus" kjb-settings-id="{{ 'type' | settings_id: section: section }}">
            <div class="panel__body">
              <h5 class="syllabus__heading">
                {{ category.title }}
                {% if category.show_as_paywalled? %}
                  {% include "icon_paywall" %}
                {% endif %}
              </h5>
              {% for post in category.posts limit:10%}
                {% include "syllabus_item" %}
              {% endfor %}
              {% if category.posts.size >= 10 %}
                <div class="syllabus__item">
                  <a href="{{ category.url }}" kjb-settings-id="{{ 'show_more' | settings_id: section: section }}">
                    {%- element "section.settings.show_more" -%}
                      {{ section.settings.show_more }}
                    {%- endelement -%}
                  </a>
                </div>
              {% endif %}
              {% if category.children? %}
                {% for category in category.subcategories %}
                  {% if category.pending_drip? %}
                    <div class="syllabus__item syllabus__item--sub" id="category-{{ category.id }}">
                      <h5 class="syllabus__heading">
                        {{ category.title }}
                        {% if category.show_as_paywalled? %}
                          {% include "icon_paywall" %}
                        {% endif %}
                        <span kjb-settings-id="{{ 'coming_soon' | settings_id: section: section }}">&nbsp;{{ section.settings.coming_soon }}</span>
                      </h5>
                    </div>
                  {% else %}
                    <div class="syllabus__item syllabus__item--sub" id="category-{{ category.id }}">
                      <h5 class="syllabus__heading">
                        {{ category.title }}
                        {% if category.show_as_paywalled? %}
                          {% include "icon_paywall" %}
                        {% endif %}
                      </h5>
                      {% for post in category.posts %}
                        {% include "syllabus_item" %}
                      {% endfor %}
                    </div>
                  {% endif %}
                {% endfor %}
              {% endif %}
            </div>
          </div>
        {% endif %}
      {% endfor %}
      {% if paginate.pages > 1 %}
        <div class="pag__wrapper">
          {% include "pagination" %}
        </div>
      {% endif %}
    {% endpaginate %}
  {% else %}
    <div class="panel syllabus" kjb-settings-id="{{ 'type' | settings_id: section: section }}">
      <div class="panel__body">
        <h5 class="syllabus__heading" kjb-settings-id="{{ 'categories' | settings_id: section: section }}">
          {% element "section.settings.categories" %}{{ section.settings.categories }}{% endelement %}<span class="pull-right">{{ current_product.categories.size }}</span>
        </h5>
        {% paginate current_product.categories by 10 %}
          {% for category in paginate.collection %}
            {% include "category" %}
          {% endfor %}
          {% if paginate.pages > 1 %}
            {% include "pagination" %}
          {% endif %}
        {% endpaginate %}
      </div>
    </div>
  {% endif %}
{% endif %}
